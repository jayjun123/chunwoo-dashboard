<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê³µì‚¬í˜„í™©</title>
  <style>
    body { font-family: 'Pretendard', 'Roboto', 'Noto Sans KR', sans-serif; background: #f4f7fb; margin: 0; }
    header { background: #fff; border-bottom: 4px solid #1976d2; padding: 1.2rem 2rem 0.7rem 2rem; display: flex; align-items: flex-end; justify-content: space-between; }
    .logo { font-size: 2rem; font-weight: bold; color: #1976d2; }
    .menu { display: flex; gap: 1.2rem; }
    .menu-item { color: #1976d2; font-weight: 500; cursor: pointer; }
    .date-box { color: #1976d2; font-size: 1.1rem; }
    main { display: flex; gap: 2rem; padding: 2rem; }
    aside { min-width: 220px; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #1976d233; padding: 1.2rem; }
    aside h3 { color: #1976d2; font-size: 1.1rem; margin: 0 0 1rem 0; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #e3eaf3; padding: 0.5rem 0.7rem; text-align: left; height: 38px; min-width: 60px; }
    .site-list-scroll-wrap { max-height: 380px; overflow-y: auto; display: block; }
    #site-list tr td:first-child { min-width: 36px; max-width: 36px; width: 36px; position: sticky; left: 0; background: #fff; z-index: 1; }
    #site-list tr td:nth-child(2) { min-width: 120px; width: 100%; color: #1976d2; font-weight: bold; cursor: pointer; background: #fff; }
    .calendar-site { display: inline-block; background: #e3f2fd; color: #1976d2; border-radius: 6px; padding: 2px 8px; margin: 2px 0; font-size: 0.98em; font-weight: 500; text-align: right; }
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼(ì„ íƒ) */
    .site-list-scroll-wrap::-webkit-scrollbar { width: 8px; }
    .site-list-scroll-wrap::-webkit-scrollbar-thumb { background: #e3eaf3; border-radius: 4px; }
    #calendar { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #1976d233; padding: 1.2rem; min-width: 420px; }
    .calendar-title { font-size: 1.5rem; color: #1976d2; font-weight: bold; text-align: center; margin-bottom: 1rem; display: inline-block; }
    .calendar-actions { float: right; display: inline-block; margin-left: 1rem; vertical-align: middle; }
    .calendar-btn { background: #fff; color: #1976d2; border: 2px solid #1976d2; border-radius: 6px; padding: 4px 16px; font-size: 1rem; font-weight: 500; margin-left: 6px; cursor: pointer; transition: background 0.2s, color 0.2s; }
    .calendar-btn:hover { background: #1976d2; color: #fff; }
    .calendar-table { width: 100%; border-collapse: collapse; }
    .calendar-table th, .calendar-table td { width: 14.2%; height: 48px; text-align: center; border: 1px solid #e3eaf3; vertical-align: middle; }
    .calendar-table th { background: #e3eaf3; color: #1976d2; font-weight: bold; padding: 2px 0 0 0; text-align: center; }
    .calendar-table .en-day { display: block; font-size: 0.95em; color: #888; font-weight: 400; margin-top: 2px; text-align: center; }
    .calendar-table td { background: #fff; color: #222; vertical-align: top; padding-top: 4px; text-align: right; }
    .calendar-date-num { display: block; font-weight: bold; margin-bottom: 2px; text-align: right; }
    .calendar-table td.sat { background: #eaf4fb; color: #1976d2; }
    .calendar-table td.sun { background: #fbeaea; color: #e53935; }
    .calendar-table td.today-cell {
      border: 3px solid #e53935 !important;
      box-sizing: border-box;
      border-radius: 8px;
    }
    .calendar-site.selected { background: #1976d2 !important; color: #fff !important; }
    /* í˜„ì¥ì •ë³´ íŒì—… ìŠ¤íƒ€ì¼ */
    .site-popup-bg {
      position: fixed; left: 0; top: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.08); z-index: 9999;
      display: flex; align-items: flex-start; justify-content: center;
    }
    .site-popup-box {
      background: #fff; border-radius: 14px; box-shadow: 0 4px 24px #1976d233;
      min-width: 260px; max-width: 90vw; min-height: 120px; padding: 1.5rem 1.7rem 1.2rem 1.7rem;
      margin-top: 60px; position: absolute;
      animation: popupShow 0.18s;
    }
    @keyframes popupShow { from { opacity: 0; transform: translateY(20px);} to { opacity: 1; transform: none; } }
    .site-popup-title { font-size: 1.15rem; font-weight: bold; color: #1976d2; margin-bottom: 0.7rem; }
    .site-popup-row { margin-bottom: 0.5rem; color: #333; font-size: 1rem; }
    .site-popup-label { color: #1976d2; font-weight: 500; margin-right: 0.5rem; }
    .site-popup-detail-btn {
      position: absolute; right: 1.2rem; bottom: 1.2rem;
      background: #1976d2; color: #fff; border: none; border-radius: 6px;
      padding: 0.5rem 1.2rem; font-size: 1rem; font-weight: 500; cursor: pointer;
      transition: background 0.2s;
    }
    .site-popup-detail-btn:hover { background: #e53935; }
    .site-loc-btn-wrap { display: flex; justify-content: flex-end; margin-top: 1.2rem; }
    .site-loc-btn { background: #1976d2; color: #fff; border: none; border-radius: 7px; padding: 0.6rem 1.4rem; font-size: 1rem; font-weight: 500; cursor: pointer; transition: background 0.2s; }
    .site-loc-btn:hover { background: #1251a6; }
    .site-detail-layout { display: flex; gap: 2rem; }
    .site-detail-list { min-width: 260px; max-width: 320px; background: #f8fafd; border-radius: 12px; box-shadow: 0 2px 8px #1976d233; padding: 1.2rem; display: flex; flex-direction: column; }
    .site-list-search { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    .site-list-search input { flex: 1; padding: 0.5rem; border-radius: 6px; border: 1.5px solid #b6c7e3; }
    .site-list-search button { background: #1976d2; color: #fff; border: none; border-radius: 6px; padding: 0.5rem 1.2rem; font-weight: 500; }
    .site-list-box { background: #fff; border-radius: 8px; margin-bottom: 1.1rem; box-shadow: 0 1px 4px #1976d211; padding: 0.7rem; }
    .site-list-title { color: #1976d2; font-weight: bold; font-size: 1.02rem; margin-bottom: 0.4rem; }
    .site-list-scroll { min-height: 80px; max-height: 120px; overflow-y: auto; background: #f8fafd; border-radius: 6px; }
    .site-detail-form { flex: 1; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #1976d233; padding: 2rem 2.2rem; min-width: 400px; }
    .site-detail-title { color: #1976d2; font-size: 1.2rem; font-weight: bold; margin-bottom: 1.2rem; }
    .site-detail-list-btn { 
      display: inline-block !important; 
      background: #1976d2; 
      color: #fff; 
      border: none; 
      border-radius: 6px; 
      padding: 0.6rem 1.3rem; 
      font-size: 1rem; 
      font-weight: 500; 
      cursor: pointer; 
    }
    .site-detail-list-btn:hover { background: #1251a6; }
    .site-detail-row { display: flex; align-items: center; gap: 1rem; margin-bottom: 0.7rem; }
    .site-detail-row label { min-width: 90px; color: #1976d2; font-weight: 500; }
    .site-detail-row input, .site-detail-row select { flex: 1; padding: 0.5rem; border-radius: 6px; border: 1.5px solid #b6c7e3; }
    .site-detail-row textarea { flex: 1; padding: 0.5rem; border-radius: 6px; border: 1.5px solid #b6c7e3; min-height: 60px; }
    .site-detail-table-box { background: #f8fafd; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
    .site-detail-table-title { color: #1976d2; font-weight: bold; margin-bottom: 0.5rem; }
    .site-detail-table-box table { width: 100%; border-collapse: collapse; margin-bottom: 0.5rem; }
    .site-detail-table-box th, .site-detail-table-box td { border: 1px solid #e3eaf3; padding: 0.3rem 0.5rem; text-align: center; }
    .site-detail-table-box th { background: #e3eaf3; color: #1976d2; font-weight: bold; }
    .site-detail-table-box button { background: #e53935; color: #fff; border: none; border-radius: 5px; padding: 0.3rem 0.7rem; font-size: 0.95rem; cursor: pointer; }
    .site-detail-table-box .add-row-btn { background: #1976d2; margin-top: 0.5rem; }
    .site-detail-btns { display: flex; gap: 0.7rem; justify-content: flex-end; margin-top: 1.2rem; }
    .site-detail-btns button { background: #1976d2; color: #fff; border: none; border-radius: 6px; padding: 0.6rem 1.3rem; font-size: 1rem; font-weight: 500; }
    .site-detail-btns button:hover { background: #1251a6; }
    /* íƒœë¸”ë¦¿ ê°€ë¡œ ëª¨ë“œ ìµœì í™” */
    @media only screen and (orientation: landscape) {
      body {
        min-width: 1024px;
        max-width: 100vw;
        overflow-x: auto;
      }
      main, section, .site-detail-layout, #discussion-section, #progress-section {
        flex-direction: row !important;
        min-width: 900px;
      }
    }
    @media only screen and (orientation: portrait) {
      body::before {
        content: "íƒœë¸”ë¦¿ì€ ê°€ë¡œëª¨ë“œ(landscape)ë¡œ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.";
        position: fixed;
        z-index: 99999;
        left: 0; top: 0; right: 0; bottom: 0;
        background: #fff;
        color: #1976d2;
        font-size: 2.2rem;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
      }
      #main-section, #site-detail-section, #all-site-list-section, #discussion-section, #progress-section, #progress-list-section {
        display: none !important;
      }
    }
    .company-category-box {
      display: flex;
      gap: 2rem;
      margin-bottom: 2rem;
    }
    .company-box {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px #1976d233;
      padding: 1.2rem;
      min-width: 260px;
      flex: 1;
    }
    .company-title {
      font-size: 1.15rem;
      font-weight: bold;
      color: #1976d2;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .company-search {
      flex: 1;
      padding: 0.3rem 0.7rem;
      border-radius: 6px;
      border: 1.5px solid #b6c7e3;
    }
    .company-find-btn {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.3rem 1rem;
      font-weight: 500;
      cursor: pointer;
    }
    .company-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }
    .company-table th, .company-table td {
      border: 1px solid #e3eaf3;
      padding: 0.3rem 0.5rem;
      text-align: center;
      font-size: 1rem;
    }
    .company-table th {
      background: #e3eaf3;
      color: #1976d2;
      font-weight: bold;
    }
    .company-bottom-btns {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }
    .company-bottom-btns button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.6rem 1.3rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
    }
    .company-category-vertical {
      display: flex;
      flex-direction: column;
      gap: 2.5rem;
    }
    .company-box-vertical {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 24px #1976d233;
      padding: 2.2rem 2.5rem 2.5rem 2.5rem;
      margin-bottom: 0;
      min-width: 400px;
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
    }
    .company-title {
      font-size: 1.25rem;
      font-weight: bold;
      color: #1976d2;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.7rem;
    }
    .company-search {
      flex: 1;
      padding: 0.4rem 1rem;
      border-radius: 6px;
      border: 1.5px solid #b6c7e3;
      font-size: 1.05rem;
    }
    .company-find-btn {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.4rem 1.2rem;
      font-weight: 500;
      cursor: pointer;
      font-size: 1.05rem;
    }
    .company-table-wrap {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px #1976d233;
      padding: 1.2rem 0.5rem 1.2rem 0.5rem;
      max-height: 320px; /* ì›í•˜ëŠ” ë†’ì´ë¡œ ì¡°ì ˆ */
      overflow-y: auto;
    }
    .company-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 0.5rem;
    }
    .company-table th, .company-table td {
      border: 1px solid #e3eaf3;
      padding: 0.5rem 0.7rem;
      text-align: center;
      font-size: 1.08rem;
    }
    .company-table th {
      background: #e3eaf3;
      color: #1976d2;
      font-weight: bold;
    }
    .company-top-btns {
      display: flex;
      gap: 1rem;
    }
    .company-top-btns button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.7rem 1.5rem;
      font-size: 1.08rem;
      font-weight: 500;
      cursor: pointer;
    }
    .member-table { width:100%; border-collapse:collapse; margin-bottom:1rem; }
    .member-table th, .member-table td { border:1px solid #e3eaf3; padding:0.5rem 0.7rem; text-align:center; }
    .member-table th { background:#e3eaf3; color:#1976d2; font-weight:bold; }
    .member-vertical-list {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }
    .member-table-wrap {
      max-height: 220px;
      overflow-y: auto;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px #1976d233;
      margin-bottom: 1rem;
    }
    .member-table th, .member-table td { font-size: 1rem; }
    .pw-eye-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.1rem;
      color: #1976d2;
      padding: 0;
    }
    .pw-eye-btn::before {
      content: 'ğŸ‘'; /* ë” ì‹¬í”Œí•œ ëˆˆëª¨ì–‘ */
      font-size: 1.1rem;
    }
    .pw-eye-btn.active::before {
      content: 'ğŸ™ˆ'; /* ë¹„ë°€ë²ˆí˜¸ ë³´ì¼ ë•Œ ì‹¬í”Œí•œ ë‹«íŒ ëˆˆ */
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body>
  <header>
    <div class="logo">Chunwoo</div>
    <div class="menu">
      <div class="menu-item">ê³µì‚¬í˜„í™©</div>
      <div class="menu-item">í˜„ì¥ì„¸ë¶€ë‚´ì—­</div>
      <div class="menu-item" id="menu-discussion">í˜‘ì˜í•˜ê¸°</div>
      <div class="menu-item">ê¸°ì„±í˜„í™©</div>
    </div>
    <div class="date-box" id="today-info"></div>
    <button id="logout-btn" style="margin-left:2rem;background:#e53935;color:#fff;border:none;border-radius:6px;padding:0.5rem 1.2rem;font-size:1rem;font-weight:500;cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
  </header>
  <section id="main-section">
    <main>
      <aside>
        <h3>ì§„í–‰ì¤‘ í˜„ì¥ LIST</h3>
        <table>
          <tbody id="site-list" class="site-list-scroll-wrap"></tbody>
        </table>
      </aside>
      <section style="flex:1;">
        <div id="calendar"></div>
      </section>
    </main>
  </section>

  <!-- í˜„ì¥ì„¸ë¶€ë‚´ì—­ í™”ë©´ -->
  <section id="site-detail-section" style="display:none;">
    <div class="site-detail-layout">
      <aside class="site-detail-list">
        <div class="site-list-search">
          <input type="text" placeholder="í˜„ì¥ëª…, íšŒì‚¬ëª… ë“± ê²€ìƒ‰">
          <button>ì°¾ê¸°</button>
        </div>
        <div class="site-list-box">
          <div class="site-list-title">ì§„í–‰ì¤‘ í˜„ì¥ LIST</div>
          <div class="site-list-scroll"></div>
        </div>
        <div class="site-list-box">
          <div class="site-list-title">ì˜ˆì • í˜„ì¥ LIST</div>
          <div class="site-list-scroll"></div>
        </div>
        <div class="site-list-box">
          <div class="site-list-title">ì™„ë£Œ í˜„ì¥ LIST</div>
          <div class="site-list-scroll"></div>
        </div>
      </aside>
      <div class="site-detail-form">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div class="site-detail-title">í˜„ì¥ ì„¸ë¶€ ì‚¬í•­</div>
          <button class="site-detail-list-btn">ì „ì²´ í˜„ì¥LIST</button>
        </div>
        <form onsubmit="return validateAndSubmit(event)">
          <div class="site-detail-row">
            <label>í˜„ì¥ëª…</label><input type="text" id="siteName" required>
          </div>
          <div class="site-detail-row">
            <label>í˜„ì¥ì£¼ì†Œ</label><input type="text" placeholder="í˜„ì¥ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
          </div>
          <div class="site-detail-row">
            <label>ê³µì‚¬ê¸°ê°„</label>
            <input type="text" id="siteStartDate" style="width:110px;" placeholder="[0000-00-00]">
            ~
            <input type="text" id="siteEndDate" style="width:110px;" placeholder="[0000-00-00]">
          </div>
          <div class="site-detail-row">
            <label>ê³„ì•½êµ¬ë¶„</label>
            <select id="site-type">
              <option value="ê³µì‚¬">ê³µì‚¬</option>
              <option value="ê³„ì•½">ê³„ì•½</option>
              <option value="NONE">NONE</option>
            </select>
            <span style="margin-left:1rem;">í˜„ì¥ ì§„í–‰ìœ¨</span>
            <select id="site-status">
              <option value="ì˜ˆì •">ì˜ˆì •</option>
              <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
              <option value="ì™„ë£Œ">ì™„ë£Œ</option>
            </select>
          </div>
          <div class="site-detail-row">
            <label>íšŒì‚¬</label><input type="text">
          </div>
          <div class="site-detail-row">
            <label>ì‹œê³µíŒ€</label><input type="text" placeholder="ì‹œê³µíŒ€ì„ ì…ë ¥í•˜ì„¸ìš”">
          </div>
          <div class="site-detail-row">
            <label>í˜„ì¥ì†Œì¥</label><input type="text">
          </div>
          <div class="site-detail-row">
            <label>ë¹„ê³ </label><input type="text">
          </div>
          <div class="site-detail-table-box">
            <div class="site-detail-table-title">ê²¬ì ë‚´ì—­</div>
            <table>
              <thead>
                <tr><th>í•­ëª©</th><th>ë¬¼ëŸ‰</th><th>ë‹¨ê°€</th><th></th></tr>
              </thead>
              <tbody>
                <tr>
                  <td><input type="text"></td>
                  <td><input type="text"></td>
                  <td><input type="text"></td>
                  <td><button type="button">ì‚­ì œ</button></td>
                </tr>
              </tbody>
            </table>
            <button type="button" class="add-row-btn">+ í–‰ ì¶”ê°€</button>
          </div>
          <div class="site-detail-row">
            <label>ë©”ëª¨/ë¦¬ìŠ¤íŠ¸</label>
            <textarea placeholder="ë©”ëª¨ ë˜ëŠ” ë¦¬ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
          </div>
          <div class="site-detail-btns">
            <button type="button">ì–‘ì‹ë‹¤ìš´</button>
            <button type="button">ì˜¬ë¦¬ê¸°</button>
            <button type="button">ê¸°ì„±í˜„í™©</button>
            <button type="submit">ë“±ë¡í•˜ê¸°</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- ì „ì²´ í˜„ì¥ LIST í™”ë©´ -->
  <section id="all-site-list-section" style="display:none; padding:2rem;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
      <h2 style="color:#1976d2;">ì „ì²´ í˜„ì¥ LIST</h2>
      <div style="display:flex;gap:1rem;">
        <button id="all-site-download-btn" style="background:#43a047;color:#fff;border:none;border-radius:6px;padding:0.6rem 1.3rem;font-size:1rem;font-weight:500;cursor:pointer;margin-right:1rem;">ì„ íƒí˜„ì¥ ë‚´ë ¤ë°›ê¸°</button>
        <button id="all-site-delete-btn" style="background:#e53935;color:#fff;border:none;border-radius:6px;padding:0.6rem 1.3rem;font-size:1rem;font-weight:500;cursor:pointer;margin-right:1rem;">ì„ íƒì‚­ì œ</button>
        <button id="all-site-back-btn" style="background:#1976d2;color:#fff;border:none;border-radius:6px;padding:0.6rem 1.3rem;font-size:1rem;font-weight:500;cursor:pointer;">ëŒì•„ê°€ê¸°</button>
      </div>
    </div>
    <input id="all-site-search" type="text" placeholder="í˜„ì¥ëª…, íšŒì‚¬ëª…, ì†Œì¥ ê²€ìƒ‰" style="width:220px;padding:0.5rem;border-radius:6px;border:1.5px solid #b6c7e3;margin-bottom:1rem;">
    <div style="overflow-x:auto;">
      <table style="width:100%;background:#fff;border-radius:12px;box-shadow:0 2px 8px #1976d233;">
        <thead>
          <tr style="background:#e3eaf3;color:#1976d2;">
            <th><input type="checkbox" id="select-all-sites" style="width:16px;height:16px;"></th>
            <th>í˜„ì¥ëª…</th>
            <th>ê³„ì•½êµ¬ë¶„</th>
            <th>ê³µì‚¬ê¸°ê°„</th>
            <th>íšŒì‚¬</th>
            <th>ì†Œì¥</th>
            <th>ê³„ì•½ê¸ˆì•¡</th>
            <th>ì‹œê³µíŒ€</th>
            <th>ë¹„ê³ </th>
          </tr>
        </thead>
        <tbody id="all-site-tbody"></tbody>
      </table>
    </div>
  </section>

  <!-- í˜‘ì˜í•˜ê¸° í™”ë©´ -->
  <section id="discussion-section" style="display:none; padding:2rem; min-height:600px;">
    <div style="display:flex; gap:2rem;">
      <!-- ì™¼ìª½: ì €ì¥ëª©ë¡ LIST -->
      <div style="flex:1; min-width:340px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;">
          <h2 style="color:#1976d2; margin-bottom:0;">ì €ì¥ëª©ë¡ LIST</h2>
          <button id="discussion-list-delete-btn" style="background:#e53935;color:#fff;border:none;border-radius:6px;padding:0.4rem 1.1rem;font-size:1rem;font-weight:500;cursor:pointer;">ì‚­ì œ</button>
        </div>
        <table style="width:100%; background:#fff; border-radius:10px; box-shadow:0 2px 8px #1976d233;">
          <thead>
            <tr style="background:#e3eaf3; color:#1976d2;">
              <th style="width:40px;">ë²ˆí˜¸</th>
              <th style="width:90px;">í˜„ì¥ëª…</th>
              <th style="width:120px;">ê¸€ ìˆ˜</th>
              <th>ë¹„ê³ </th>
              <th style="width:40px;">
                <input type="checkbox" id="discussion-list-check-all" style="width:16px;height:16px;">
              </th>
            </tr>
          </thead>
          <tbody id="discussion-list-tbody"></tbody>
        </table>
      </div>
      <!-- ì˜¤ë¥¸ìª½: ì‚¬ì§„, í˜„ì¥ì„ íƒ, ë©”ëª¨ -->
      <div style="flex:1.2; min-width:340px;">
        <!-- í˜„ì¥ëª… í‘œì‹œ -->
        <div id="discussion-selected-site" style="font-size:1.2rem;font-weight:600;color:#1976d2;margin-bottom:0.7rem;"></div>
        <!-- ì „ì†¡ëœ ê¸€ ë¦¬ìŠ¤íŠ¸(ìµœì‹ ìˆœ) -->
        <div id="discussion-memo-list" style="margin-bottom:2rem;max-height:320px;overflow-y:auto;"></div>
        <!-- í˜„ì¥ ì„ íƒ/ë©”ëª¨ ì…ë ¥/ë²„íŠ¼ -->
        <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
          <select id="discussion-site-select" style="flex:1; padding:0.5rem; border-radius:6px; border:1.5px solid #b6c7e3;"></select>
          <button id="discussion-find-btn" style="background:#1976d2;color:#fff;padding:0.5rem 1.2rem;border:none;border-radius:6px;cursor:pointer;">ì°¾ê¸°</button>
        </div>
        <div style="margin-bottom:1rem;">
          <textarea id="discussion-memo" maxlength="100" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 100ì)" style="width:100%;height:70px;padding:0.7rem;border-radius:8px;border:1.5px solid #b6c7e3;"></textarea>
        </div>
        <div style="display:flex; gap:0.5rem; justify-content:flex-end; align-items:center;">
          <input type="file" id="discussion-photo" accept="image" style="display:none;">
          <label for="discussion-photo" style="background:#1976d2;color:#fff;padding:0.5rem 1.2rem;border-radius:6px;cursor:pointer;">ì‚¬ì§„ ì²¨ë¶€</label>
          <button id="discussion-send-btn" style="background:#1976d2;color:#fff;padding:0.6rem 1.5rem;border:none;border-radius:6px;cursor:pointer;font-size:1rem;">ì „ì†¡</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ê¸°ì„±í˜„í™© í™”ë©´ -->
  <section id="progress-section" style="display:none; padding:2rem;">
    <div style="display:flex; gap:2rem;">
      <!-- ì™¼ìª½: ì›”ë³„/í˜„ì¥ë³„ í˜„í™© -->
      <div style="flex:2; min-width:400px;">
        <!-- ì˜¤ëŠ˜ ì •ë³´ ë°•ìŠ¤ ì¶”ê°€ -->
        <div id="progress-today-info" style="margin-bottom:1.2rem;"></div>
        <!-- ì›”ë³„ í˜„í™© -->
        <div style="background:#fff; border-radius:16px; box-shadow:0 2px 8px #1976d233; padding:2rem; margin-bottom:2rem; position:relative;">
          <div style="font-size:1.1rem; font-weight:600; color:#1976d2; margin-bottom:1rem;">ì›”ë³„ í˜„í™©</div>
          <select id="progress-month-select" style="position:absolute; top:2rem; right:2rem; padding:0.4rem 1rem; border-radius:6px; border:1.5px solid #b6c7e3;"></select>
          <table style="width:100%; background:#fff; border-radius:12px; box-shadow:0 2px 8px #1976d233;">
            <thead>
              <tr style="background:#e3eaf3;color:#1976d2;">
                <th>í˜„ì¥ëª…</th>
                <th>ê³„ì•½ê¸ˆì•¡</th>
                <th>ì²­êµ¬ê¸ˆì•¡</th>
                <th>ì§€ê¸‰ê¸ˆì•¡</th>
                <th>ì”ì•¡</th>
              </tr>
            </thead>
            <tbody id="progress-month-tbody"></tbody>
          </table>
        </div>
        <!-- í˜„ì¥ë³„ í˜„í™© -->
        <div style="background:#fff; border-radius:16px; box-shadow:0 2px 8px #1976d233; padding:2rem;">
          <div style="font-size:1.1rem; font-weight:600; color:#1976d2; margin-bottom:1rem;">í˜„ì¥ë³„ í˜„í™©</div>
          <div style="margin-bottom:1rem;">
            <input type="text" id="progress-search-input" placeholder="í˜„ì¥ëª… ê²€ìƒ‰" style="width:220px;padding:0.5rem;border-radius:6px;border:1.5px solid #b6c7e3;">
            <button id="progress-search-btn" style="background:#1976d2;color:#fff;padding:0.5rem 1.2rem;border:none;border-radius:6px;cursor:pointer;">ì°¾ê¸°</button>
          </div>
          <table style="width:100%; background:#fff; border-radius:12px; box-shadow:0 2px 8px #1976d233;">
            <thead>
              <tr style="background:#e3eaf3;color:#1976d2;">
                <th>í˜„ì¥ëª…</th>
                <th>ê³„ì•½ê¸ˆì•¡</th>
                <th>ì²­êµ¬ê¸ˆì•¡</th>
                <th>ì§€ê¸‰ê¸ˆì•¡</th>
                <th>ì”ì•¡</th>
              </tr>
            </thead>
            <tbody id="progress-site-tbody"></tbody>
          </table>
        </div>
      </div>
      <!-- ì˜¤ë¥¸ìª½: ì²­êµ¬/ì§€ê¸‰ ì…ë ¥í¼ -->
      <div style="flex:1; min-width:320px; background:#fff; border-radius:16px; box-shadow:0 2px 8px #1976d233; padding:2rem;">
        <div style="font-size:1.2rem; font-weight:600; color:#1976d2; margin-bottom:1.2rem;">ì²­êµ¬/ì§€ê¸‰ ì…ë ¥</div>
        <div style="display:flex; justify-content:flex-end; align-items:center; margin-bottom:1.2rem;">
          <button id="progress-upload-btn" style="background:#1976d2;color:#fff;padding:0.5rem 1.2rem;border:none;border-radius:6px;cursor:pointer;margin-right:0.7rem;">ì˜¬ë¦¬ê¸°</button>
          <button id="progress-template-btn" style="background:#43a047;color:#fff;padding:0.5rem 1.2rem;border:none;border-radius:6px;cursor:pointer;margin-right:0.7rem;">ì–‘ì‹ ë‹¤ìš´ë¡œë“œ</button>
          <button id="progress-list-btn" style="background:#43a047;color:#fff;padding:0.5rem 1.2rem;border:none;border-radius:6px;cursor:pointer;">ê¸°ì„±í˜„í™© LIST</button>
        </div>
        <div style="margin-bottom:1rem;">
          <label>í˜„ì¥ëª…</label>
          <select id="progress-site-select" style="width:100%;padding:0.5rem;border-radius:6px;border:1.5px solid #b6c7e3;margin-bottom:0.7rem;"></select>
        </div>
        <div style="margin-bottom:1rem;">
          <label>êµ¬ë¶„</label>
          <select id="progress-type-select" style="width:100%;padding:0.5rem;border-radius:6px;border:1.5px solid #b6c7e3;margin-bottom:0.7rem;">
            <option value="ì²­êµ¬">ì²­êµ¬</option>
            <option value="ì§€ê¸‰">ì§€ê¸‰</option>
          </select>
        </div>
        <div style="margin-bottom:1rem;">
          <label>ê³„ì‚°ì„œìœ ë¬´</label>
          <select id="progress-kind-select" style="width:100%;padding:0.5rem;border-radius:6px;border:1.5px solid #b6c7e3;margin-bottom:0.7rem;">
            <option value="ê³„ì‚°ì„œ">ê³„ì‚°ì„œ</option>
            <option value="ë…¸ë¬´ë¹„">ë…¸ë¬´ë¹„</option>
          </select>
        </div>
        <div style="margin-bottom:1rem;">
          <label>ê¸ˆì•¡</label>
          <input type="number" id="progress-amount" style="width:100%;padding:0.5rem;border-radius:6px;border:1.5px solid #b6c7e3;">
        </div>
        <div style="margin-bottom:1rem;">
          <label>ë‚ ì§œ</label>
          <input type="date" id="progress-date" style="width:100%;padding:0.5rem;border-radius:6px;border:1.5px solid #b6c7e3;">
        </div>
        <div style="margin-bottom:1rem;">
          <label>ë¹„ê³ </label>
          <input type="text" id="progress-note" style="width:100%;padding:0.5rem;border-radius:6px;border:1.5px solid #b6c7e3;">
        </div>
        <button id="progress-save-btn" style="background:#1976d2;color:#fff;padding:0.6rem 1.5rem;border:none;border-radius:6px;cursor:pointer;font-size:1rem;width:100%;">ì €ì¥</button>
      </div>
    </div>
  </section>

  <!-- ê¸°ì„±í˜„í™© LIST í™”ë©´ -->
  <section id="progress-list-section" style="display:none; padding:2rem;">
    <div style="max-width:480px; margin:0 auto;">
      <h2 style="color:#1976d2; margin-bottom:1rem;">ê¸°ì„±í˜„í™© LIST</h2>
      <table style="width:100%; background:#fff; border-radius:12px; box-shadow:0 2px 8px #1976d233;">
        <thead>
          <tr style="background:#e3eaf3;color:#1976d2;">
            <th>í˜„ì¥ëª…</th>
            <th>êµ¬ë¶„</th>
            <th>ê³„ì‚°ì„œ</th>
            <th>ê¸ˆì•¡</th>
            <th>ë‚ ì§œ</th>
            <th>ë¹„ê³ </th>
          </tr>
        </thead>
        <tbody id="progress-list-tbody"></tbody>
      </table>
      <div style="text-align:right; margin-top:1.2rem;">
        <button id="progress-list-back-btn" style="background:#1976d2;color:#fff;padding:0.5rem 1.2rem;border:none;border-radius:6px;cursor:pointer;">ëŒì•„ê°€ê¸°</button>
      </div>
    </div>
  </section>

  <!-- ê±°ë˜ì²˜ í˜„í™© ê´€ë¦¬ ì„¹ì…˜ (ì„¸ë¡œ ë°°ì¹˜ ë° ë²„íŠ¼ ìƒë‹¨ ì´ë™) -->
  <section id="company-section" style="padding:2rem; display:none;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:2rem;">
      <h2 style="color:#1976d2;">ê±°ë˜ì²˜ í˜„í™© ê´€ë¦¬</h2>
      <div class="company-top-btns">
        <button class="company-upload-btn">ì˜¬ë¦¬ê¸°</button>
        <button class="company-download-btn">ë‚´ë ¤ë°›ê¸°</button>
        <button class="company-delete-btn">ì‚­ì œ</button>
        <button class="company-add-btn">ì¶”ê°€</button>
        <input type="file" id="company-excel-input" style="display:none;">
      </div>
    </div>
    <div class="company-category-vertical">
      <!-- ê±´ì„¤ì—…ì²´ -->
      <div class="company-box-vertical" data-type="ê±´ì„¤ì—…ì²´">
        <div class="company-title">ê±´ì„¤ì—…ì²´
          <input type="text" class="company-search" placeholder="ê²€ìƒ‰">
          <button class="company-find-btn">ì°¾ê¸°</button>
        </div>
        <div class="company-table-wrap">
          <table class="company-table">
            <thead>
              <tr>
                <th><input type="checkbox" class="company-check-all"></th>
                <th>ì—…ì²´ëª…</th>
                <th>ë‚©í’ˆê¸°í•œì¼ì</th>
                <th>ê³„ì•½ê±´ëª…</th>
                <th>ê¸ˆì•¡</th>
                <th>ë¹„ê³ </th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- ALê´€ê¸‰ì—…ì²´ -->
      <div class="company-box-vertical" data-type="ALê´€ê¸‰ì—…ì²´">
        <div class="company-title">ALê´€ê¸‰ì—…ì²´
          <input type="text" class="company-search" placeholder="ê²€ìƒ‰">
          <button class="company-find-btn">ì°¾ê¸°</button>
        </div>
        <div class="company-table-wrap">
          <table class="company-table">
            <thead>
              <tr>
                <th><input type="checkbox" class="company-check-all"></th>
                <th>ì—…ì²´ëª…</th>
                <th>ë‚©í’ˆê¸°í•œì¼ì</th>
                <th>ê³„ì•½ê±´ëª…</th>
                <th>ê¸ˆì•¡</th>
                <th>ë¹„ê³ </th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- PLê´€ê¸‰ì—…ì²´ -->
      <div class="company-box-vertical" data-type="PLê´€ê¸‰ì—…ì²´">
        <div class="company-title">PLê´€ê¸‰ì—…ì²´
          <input type="text" class="company-search" placeholder="ê²€ìƒ‰">
          <button class="company-find-btn">ì°¾ê¸°</button>
        </div>
        <div class="company-table-wrap">
          <table class="company-table">
            <thead>
              <tr>
                <th><input type="checkbox" class="company-check-all"></th>
                <th>ì—…ì²´ëª…</th>
                <th>ë‚©í’ˆê¸°í•œì¼ì</th>
                <th>ê³„ì•½ê±´ëª…</th>
                <th>ê¸ˆì•¡</th>
                <th>ë¹„ê³ </th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- HTMLì— ë¡œê·¸ì¸ ì„¹ì…˜ ì¶”ê°€ -->
  <div id="login-section" style="position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:99999;background:#f4f7fb;display:flex;align-items:center;justify-content:center;">
    <form id="login-form" style="background:#fff;padding:2.5rem 2.5rem 2rem 2.5rem;border-radius:16px;box-shadow:0 4px 24px #1976d233;display:flex;flex-direction:column;gap:1.2rem;min-width:320px;">
      <div style="font-size:1.5rem;font-weight:bold;color:#1976d2;text-align:center;margin-bottom:1rem;">ë¡œê·¸ì¸</div>
      <input id="login-id" type="text" placeholder="ì•„ì´ë””" required style="padding:0.7rem;border-radius:8px;border:1.5px solid #b6c7e3;">
      <input id="login-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required style="padding:0.7rem;border-radius:8px;border:1.5px solid #b6c7e3;">
      <button type="submit" style="background:#1976d2;color:#fff;border:none;border-radius:8px;padding:0.7rem;font-size:1.1rem;font-weight:500;cursor:pointer;">ë¡œê·¸ì¸</button>
      <button type="button" id="show-signup-btn" style="background:#43a047;color:#fff;border:none;border-radius:8px;padding:0.7rem;font-size:1.1rem;font-weight:500;cursor:pointer;margin-top:0.5rem;">íšŒì›ê°€ì…</button>
      <div id="login-error" style="color:#e53935;font-size:1rem;text-align:center;display:none;">ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
    </form>
  </div>

  <!-- íšŒì›í˜„í™© í™”ë©´ -->
  <section id="member-section" style="display:none; padding:2rem;">
    <div style="max-width:420px; margin:0 auto;">
      <h2 style="color:#1976d2;">íšŒì›í˜„í™©</h2>
      <div class="member-vertical-list">
        <div>
          <h3>íšŒì› ì‹ ì²­ëª©ë¡</h3>
          <div class="member-table-wrap"><table class="member-table" id="request-list">...</table></div>
        </div>
        <div>
          <h3>ì¼ë°˜íšŒì›</h3>
          <div class="member-table-wrap"><table class="member-table" id="user-list">...</table></div>
        </div>
        <div>
          <h3>ê´€ë¦¬ì</h3>
          <div class="member-table-wrap"><table class="member-table" id="admin-list">...</table></div>
        </div>
      </div>
    </div>
  </section>

  <section id="auth-section" style="display:none; padding:2rem;">
    <div style="max-width:700px; margin:0 auto;">
      <h2 style="color:#1976d2;">ë©”ë‰´ê¶Œí•œ ê´€ë¦¬</h2>
      <table class="auth-table" style="width:100%;margin-top:1.5rem;">
        <thead>
          <tr>
            <th>ë©”ë‰´</th>
            <th>ê¶Œí•œ</th>
            <th>ì½ê¸°</th>
            <th>ì“°ê¸°</th>
            <th>ì˜¬ë¦¬ê¸°</th>
            <th>ë‚´ë ¤ë°›ê¸°</th>
            <th>ìˆ˜ì •</th>
          </tr>
        </thead>
        <tbody id="auth-tbody"></tbody>
      </table>
    </div>
  </section>

  <div id="signup-popup" style="display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:99999;background:rgba(0,0,0,0.5);">
    <div style="background:#fff;padding:2.5rem;border-radius:16px;box-shadow:0 4px 24px #1976d233;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);min-width:360px;">
      <div style="font-size:1.5rem;font-weight:bold;color:#1976d2;text-align:center;margin-bottom:1.5rem;">íšŒì›ê°€ì…</div>
      <form id="signup-form" style="display:flex;flex-direction:column;gap:1rem;">
        <input type="text" id="signup-id" placeholder="ì•„ì´ë””" required style="padding:0.7rem;border-radius:8px;border:1.5px solid #b6c7e3;">
        <input type="password" id="signup-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" required style="padding:0.7rem;border-radius:8px;border:1.5px solid #b6c7e3;">
        <input type="password" id="signup-pw-confirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required style="padding:0.7rem;border-radius:8px;border:1.5px solid #b6c7e3;">
        <input type="text" id="signup-name" placeholder="ì´ë¦„" required style="padding:0.7rem;border-radius:8px;border:1.5px solid #b6c7e3;">
        <input type="text" id="signup-org" placeholder="ì†Œì†" required style="padding:0.7rem;border-radius:8px;border:1.5px solid #b6c7e3;">
        <div style="display:flex;gap:0.7rem;margin-top:0.5rem;">
          <button type="submit" style="flex:1;background:#1976d2;color:#fff;border:none;border-radius:8px;padding:0.7rem;font-size:1.1rem;font-weight:500;cursor:pointer;">ê°€ì…í•˜ê¸°</button>
          <button type="button" id="signup-close" style="flex:1;background:#e53935;color:#fff;border:none;border-radius:8px;padding:0.7rem;font-size:1.1rem;font-weight:500;cursor:pointer;">ì·¨ì†Œ</button>
        </div>
      </form>
      <div id="signup-error" style="color:#e53935;font-size:1rem;text-align:center;margin-top:1rem;display:none;"></div>
    </div>
  </div>

  <!-- íŒì—… HTML ì¶”ê°€ -->
  <div id="member-delete-popup" style="display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:99999;background:rgba(0,0,0,0.15);align-items:center;justify-content:center;">
    <div style="background:#fff;padding:2rem 2.5rem;border-radius:16px;box-shadow:0 4px 24px #1976d233;display:flex;flex-direction:column;gap:1.2rem;min-width:320px;align-items:center;">
      <div style="font-size:1.2rem;font-weight:bold;color:#e53935;text-align:center;margin-bottom:1rem;">ì •ë§ë¡œ ì´ íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
      <div style="display:flex;gap:1.5rem;justify-content:center;">
        <button id="member-delete-confirm" style="background:#e53935;color:#fff;border:none;border-radius:8px;padding:0.7rem 2.2rem;font-size:1.1rem;font-weight:500;cursor:pointer;">ì‚­ì œ</button>
        <button id="member-delete-cancel" style="background:#b6c7e3;color:#333;border:none;border-radius:8px;padding:0.7rem 2.2rem;font-size:1.1rem;font-weight:500;cursor:pointer;">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <!-- ê¸°ì„±í˜„í™© íƒ­ -->
  <div class="tab" id="progress-tab" style="display: none;">ê¸°ì„±í˜„í™©</div>
  <div id="progress-content" class="tab-content" style="display: none;">
    <div class="progress-container">
      <div class="progress-input-group">
        <select id="progress-site" class="form-control">
          <option value="">í˜„ì¥ ì„ íƒ</option>
        </select>
        <input type="month" id="progress-month" class="form-control">
        <input type="number" id="progress-value" class="form-control" placeholder="ê¸°ì„±ë¥  (%)" min="0" max="100">
        <button id="save-progress" class="btn btn-primary">ì €ì¥</button>
        <button id="delete-progress" class="btn btn-danger">ì‚­ì œ</button>
      </div>
      <div id="progress-list" class="progress-list"></div>
    </div>
  </div>

  <script>
    // ì„ì‹œ í˜„ì¥ ë°ì´í„°
    const sites = [
      { name: 'í˜„ì¥A', start: '2025-05-01', end: '2025-05-20', manager: 'í™ê¸¸ë™', team: 'AíŒ€', address: 'ëŒ€êµ¬ì‹œ ì¤‘êµ¬' },
      { name: 'í˜„ì¥B', start: '2025-04-25', end: '2025-05-10', manager: 'ê¹€ì² ìˆ˜', team: 'BíŒ€', address: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬' },
      { name: 'í˜„ì¥C', start: '2025-05-15', end: '2025-06-05', manager: 'ì´ì˜í¬', team: 'CíŒ€', address: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬' },
      { name: 'í˜„ì¥D', start: '2025-06-01', end: '2025-06-30', manager: 'ë°•ë¯¼ìˆ˜', team: 'DíŒ€', address: 'ê´‘ì£¼ì‹œ ë¶êµ¬' }
    ];

    // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
    function updateTodayInfo() {
      const now = new Date();
      const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      const year = now.getFullYear();
      const month = now.getMonth() + 1;
      const date = now.getDate();
      const day = days[now.getDay()];
      document.getElementById('today-info').textContent = `${year}ë…„ ${month}ì›” ${date}ì¼ (${day})`;
    }
    updateTodayInfo();

    // ì§„í–‰ì¤‘ í˜„ì¥ ë¦¬ìŠ¤íŠ¸(í˜„ì¬ ë‹¬ì— ê³µì‚¬ê¸°ê°„ì´ ê²¹ì¹˜ëŠ” í˜„ì¥ë§Œ)
    function renderSiteList() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const first = new Date(year, month, 1);
      const last = new Date(year, month + 1, 0);
      // ì „ì²´ í˜„ì¥ LISTì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
      const allSitesRaw = localStorage.getItem('allSites');
      const list = allSitesRaw ? JSON.parse(allSitesRaw) : [];
      // ì§„í–‰ì¤‘ + ê³µì‚¬ê¸°ê°„ì´ í˜„ì¬ ë‹¬ì— í¬í•¨ë˜ëŠ” í˜„ì¥ë§Œ
      const filtered = list.filter(site => {
        if(site.status !== 'ì§„í–‰ì¤‘') return false;
        if(!site.period) return false;
        const arr = site.period.split('~');
        if(arr.length<2) return false;
        const s = new Date(arr[0].trim());
        const e = new Date(arr[1].trim());
        return !(e < first || s > last);
      });
      const tbody = document.getElementById('site-list');
      tbody.innerHTML = '';
      filtered.forEach((site, idx) => {
        // í˜„ì¥ëª… 3ê¸€ì ë’¤ì— (ì§„í–‰ìœ¨) í‘œì‹œ
        const name = site.name ? site.name.slice(0,3)+(site.name.length>3?"...":"") : '';
        const percent = site.status === 'ì§„í–‰ì¤‘' ? '(ì§„í–‰ì¤‘)' : site.status === 'ì˜ˆì •' ? '(ì˜ˆì •)' : site.status === 'ì™„ë£Œ' ? '(ì™„ë£Œ)' : '';
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><input type="checkbox" class="main-site-checkbox" data-index="${idx}" style="width:16px;height:16px;"></td><td draggable="true" class="draggable-site">${name} ${percent}</td>`;
        // ë“œë˜ê·¸ ì´ë²¤íŠ¸(í˜„ì¥ëª…ë§Œ)
        tr.children[1].addEventListener('dragstart', function(e) {
          e.dataTransfer.setData('text/plain', site.name);
        });
        // ë”ë¸”í´ë¦­ íŒì—…
        tr.children[1].addEventListener('dblclick', function(e) {
          showSitePopup(site, e);
        });
        tbody.appendChild(tr);
      });
    }
    renderSiteList();

    // ë‹¬ë ¥(ì›”~ì¼, ì›”ìš”ì¼ ì‹œì‘)
    function renderCalendar() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay(); // ì¼ìš”ì¼ ì‹œì‘
      let html = `<div style='display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;'>`;
      html += `<span class=\"calendar-title\">${year}ë…„ ${month + 1}ì›”</span>`;
      html += `<span class='calendar-actions'>`;
      html += `<button class='calendar-btn' id='calendar-delete-btn'>ì‚­ì œ</button>`;
      html += `<button class='calendar-btn' id='calendar-save-btn'>ì €ì¥</button>`;
      html += `</span></div>`;
      html += '<table class="calendar-table"><thead><tr>';
      const weekNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      const weekEn = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
      weekNames.forEach((w, i) => {
        let thClass = '';
        if(i === 6) thClass = 'sat';
        else if(i === 0) thClass = 'sun';
        html += `<th class='${thClass}'><div style='display:flex;flex-direction:column;align-items:center;justify-content:center;'><span>${w}</span><span class='en-day'>${weekEn[i]}</span></div></th>`;
      });
      html += '</tr></thead><tbody>';
      let date = 1 - startDay;
      const todayY = now.getFullYear(), todayM = now.getMonth(), todayD = now.getDate();
      for(let r=0;r<6;r++) {
        html += '<tr>';
        for(let c=0;c<7;c++,date++) {
          if(date < 1 || date > lastDay.getDate()) html += '<td></td>';
          else {
            let cls = '';
            if(c === 6) cls = 'sat';
            if(c === 0) cls = 'sun';
            let todayClass = '';
            if(year === todayY && month === todayM && date === todayD) todayClass = ' today-cell';
            html += `<td class="${cls}${todayClass}" data-date="${year}-${month+1}-${date}"><span class='calendar-date-num'>${date}</span></td>`;
          }
        }
        html += '</tr>';
        if(date > lastDay.getDate()) break;
      }
      html += '</tbody></table>';
      document.getElementById('calendar').innerHTML = html;
      // ë“œë¡­ ì´ë²¤íŠ¸ ì—°ê²°
      document.querySelectorAll('.calendar-table td').forEach(td => {
        td.addEventListener('dragover', function(e) { e.preventDefault(); });
        td.addEventListener('drop', function(e) {
          e.preventDefault();
          const siteName = e.dataTransfer.getData('text/plain');
          if(siteName) {
            // ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸ í›„ ì—†ìœ¼ë©´ ì¶”ê°€
            let exists = false;
            this.querySelectorAll('.calendar-site').forEach(div => { if(div.textContent === siteName) exists = true; });
            if(!exists) {
              const div = document.createElement('div');
              div.className = 'calendar-site';
              div.textContent = siteName;
              div.onclick = function(e) {
                e.stopPropagation();
                this.classList.toggle('selected');
              };
              div.ondblclick = function(e) {
                e.stopPropagation();
                const allSites = JSON.parse(localStorage.getItem('allSites')||'[]');
                const site = allSites.find(s => s.name === siteName);
                if(site) showSitePopup(site, e);
              };
              // ë‚ ì§œ ìˆ«ì(span) ë‹¤ìŒì— ë°°ì¹˜
              const dateNum = this.querySelector('.calendar-date-num');
              if(dateNum && dateNum.nextSibling) {
                this.insertBefore(div, dateNum.nextSibling);
              } else {
                this.appendChild(div);
              }
            }
          }
        });
      });
      // ì €ì¥ëœ í˜„ì¥ ë°°ì¹˜ ë¶ˆëŸ¬ì˜¤ê¸°
      const saved = JSON.parse(localStorage.getItem('calendarSites')||'{}');
      const currentMonthKey = `${year}-${month+1}`;
      if(saved[currentMonthKey]) {
        document.querySelectorAll('.calendar-table td[data-date]').forEach(td => {
          const date = td.dataset.date;
          if(saved[currentMonthKey][date]) {
            saved[currentMonthKey][date].forEach(siteName => {
              let exists = false;
              td.querySelectorAll('.calendar-site').forEach(div => { if(div.textContent === siteName) exists = true; });
              if(!exists) {
                const div = document.createElement('div');
                div.className = 'calendar-site';
                div.textContent = siteName;
                div.onclick = function(e) {
                  e.stopPropagation();
                  this.classList.toggle('selected');
                };
                div.ondblclick = function(e) {
                  e.stopPropagation();
                  const allSites = JSON.parse(localStorage.getItem('allSites')||'[]');
                  const site = allSites.find(s => s.name === siteName);
                  if(site) showSitePopup(site, e);
                };
                // ë‚ ì§œ ìˆ«ì(span) ë‹¤ìŒì— ë°°ì¹˜
                const dateNum = td.querySelector('.calendar-date-num');
                if(dateNum && dateNum.nextSibling) {
                  td.insertBefore(div, dateNum.nextSibling);
                } else {
                  td.appendChild(div);
                }
              }
            });
          }
        });
      }
      // ë²„íŠ¼ ë™ì‘
      document.getElementById('calendar-save-btn').onclick = function() {
        // ë‚ ì§œë³„ë¡œ í˜„ì¥ëª… ì €ì¥
        const savedSites = {};
        document.querySelectorAll('.calendar-table td[data-date]').forEach(td => {
          const date = td.dataset.date;
          const sites = Array.from(td.querySelectorAll('.calendar-site')).map(div => div.textContent);
          if(sites.length > 0) {
            if(!savedSites[currentMonthKey]) savedSites[currentMonthKey] = {};
            savedSites[currentMonthKey][date] = sites;
          }
        });
        // ê¸°ì¡´ ë°ì´í„°ì™€ ë³‘í•©
        let all = JSON.parse(localStorage.getItem('calendarSites')||'{}');
        all[currentMonthKey] = savedSites[currentMonthKey]||{};
        localStorage.setItem('calendarSites', JSON.stringify(all));
        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      };
      document.getElementById('calendar-delete-btn').onclick = function() {
        // ì„ íƒëœ .calendar-siteë§Œ ì‚­ì œ
        document.querySelectorAll('.calendar-site.selected').forEach(div => div.remove());
      };
    }
    renderCalendar();

    // í˜„ì¥ì •ë³´ íŒì—… í•¨ìˆ˜
    function showSitePopup(site, event) {
      // ê¸°ì¡´ íŒì—… ì œê±°
      document.querySelectorAll('.site-popup-bg').forEach(el=>el.remove());
      // íŒì—… ë°°ê²½
      const bg = document.createElement('div');
      bg.className = 'site-popup-bg';
      // íŒì—… ë°•ìŠ¤
      const box = document.createElement('div');
      box.className = 'site-popup-box';
      // ë‚´ìš©
      box.innerHTML = `
        <div class='site-popup-title'>${site.name}</div>
        <div class='site-popup-row'><span class='site-popup-label'>í˜„ì¥ì†Œì¥</span>${site.manager||'-'}</div>
        <div class='site-popup-row'><span class='site-popup-label'>ì‹œê³µíŒ€</span>${site.team||'-'}</div>
        <div class='site-popup-row'><span class='site-popup-label'>ìœ„ì¹˜</span>${site.address||'-'}</div>
        <div class='site-popup-detail-btn-wrap' style="margin-top:2.2rem;text-align:right;">
          <button class='site-popup-detail-btn'>ì„¸ë¶€ë‚´ì—­</button>
        </div>
      `;
      // íŒì—… ìœ„ì¹˜(ë”ë¸”í´ë¦­ ìœ„ì¹˜)
      box.style.left = (event.clientX+10)+'px';
      box.style.top = (event.clientY+10)+'px';
      box.style.position = 'absolute';
      bg.appendChild(box);
      document.body.appendChild(bg);
      // ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
      setTimeout(()=>{
        document.addEventListener('mousedown', closePopupIfOutside);
      }, 50);
      function closePopupIfOutside(e) {
        if(!box.contains(e.target)) {
          bg.remove();
          document.removeEventListener('mousedown', closePopupIfOutside);
        }
      }
      // ESCë¡œ ë‹«ê¸°
      function escClose(e) {
        if(e.key==='Escape') {
          bg.remove();
          document.removeEventListener('keydown', escClose);
          document.removeEventListener('mousedown', closePopupIfOutside);
        }
      }
      document.addEventListener('keydown', escClose);
    }

    // í™”ë©´ ì „í™˜: í˜„ì¥ì„¸ë¶€ë‚´ì—­ ë²„íŠ¼ í´ë¦­ ì‹œ
    document.addEventListener('DOMContentLoaded', function() {
      var menuItems = document.querySelectorAll('.menu-item');
      if(menuItems[1]) menuItems[1].onclick = function() {
        document.getElementById('main-section').style.display = 'none';
        document.getElementById('site-detail-section').style.display = 'block';
      };
      // Chunwoo ë¡œê³ ë‚˜ 'ê³µì‚¬í˜„í™©' ë©”ë‰´ í´ë¦­ ì‹œ ë©”ì¸í™”ë©´ìœ¼ë¡œ ì „í™˜
      if(menuItems[0]) menuItems[0].onclick = showMain;
      var logo = document.querySelector('.logo');
      if(logo) logo.onclick = showMain;
      function showMain() {
        document.getElementById('main-section').style.display = 'block';
        document.getElementById('site-detail-section').style.display = 'none';
      }
      flatpickr("#siteStartDate", {dateFormat: "Y-m-d"});
      flatpickr("#siteEndDate", {dateFormat: "Y-m-d"});
      renderSiteList();
      renderStatusSiteLists();
      // ê³µì‚¬í˜„í™© ë©”ë‰´(ì²« ë²ˆì§¸ ë©”ë‰´) í´ë¦­ ì‹œ ìƒˆë¡œê³ ì¹¨
      if(menuItems[0]) {
        menuItems[0].onclick = function() {
          location.reload();
        };
      }
    });

    // ì €ì¥
    document.querySelector('.site-detail-btns button[type="submit"]').onclick = function(e) {
      e.preventDefault();
      const form = document.querySelector('.site-detail-form form');
      const siteName = form.querySelector('#siteName').value.trim();
      if (!siteName) {
        alert('í˜„ì¥ëª…ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
        form.querySelector('#siteName').focus();
        return;
      }
      const data = {
        name: siteName,
        address: form.querySelectorAll('input[type="text"]')[1].value,
        period: form.querySelectorAll('input[type="text"]')[2].value + ' ~ ' + form.querySelectorAll('input[type="text"]')[3].value,
        type: document.getElementById('site-type').value,
        status: document.getElementById('site-status').value,
        company: form.querySelectorAll('input[type="text"]')[4].value,
        team: form.querySelectorAll('input[type="text"]')[5].value,
        manager: form.querySelectorAll('input[type="text"]')[6].value,
        note: form.querySelectorAll('input[type="text"]')[7].value,
        total: '', // ê³„ì•½ê¸ˆì•¡ì€ ì¶”í›„ ì¶”ê°€
      };
      let list = JSON.parse(localStorage.getItem('allSites')||'[]');
      // ë™ì¼ ì´ë¦„ í˜„ì¥ ìˆìœ¼ë©´ ìˆ˜ì •, ì—†ìœ¼ë©´ ì¶”ê°€
      const idx = list.findIndex(s => s.name === data.name);
      if(idx >= 0) list[idx] = data;
      else list.push(data);
      localStorage.setItem('allSites', JSON.stringify(list));
      alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      afterSiteSave();
    };

    // ì „ì²´ í˜„ì¥LIST ë²„íŠ¼
    document.querySelector('.site-detail-list-btn').onclick = function() {
      document.getElementById('site-detail-section').style.display = 'none';
      document.getElementById('all-site-list-section').style.display = 'block';
      renderAllSiteList();
    };

    // ëŒì•„ê°€ê¸° ë²„íŠ¼
    document.getElementById('all-site-back-btn').onclick = function() {
      document.getElementById('all-site-list-section').style.display = 'none';
      document.getElementById('site-detail-section').style.display = 'block';
    };

    // ì „ì²´ í˜„ì¥ LIST ë Œë”ë§
    function renderAllSiteList() {
      let list = JSON.parse(localStorage.getItem('allSites')||'[]');
      // ì¢…ë£Œì¼ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
      list = list.slice().sort((a, b) => {
        const getEnd = s => {
          if(!s.period) return 0;
          const arr = s.period.split('~');
          if(arr.length<2) return 0;
          return new Date(arr[1].trim()).getTime();
        };
        return getEnd(b) - getEnd(a);
      });
      const tbody = document.getElementById('all-site-tbody');
      tbody.innerHTML = '';
      list.forEach((site, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="checkbox" class="site-checkbox" data-index="${index}" style="width:16px;height:16px;"></td>
          <td>${site.name||''}</td>
          <td>${site.type||''}</td>
          <td>${site.period||''}</td>
          <td>${site.company||''}</td>
          <td>${site.manager||''}</td>
          <td style="text-align:right;">${site.total||''}</td>
          <td>${site.team||''}</td>
          <td>${site.note||''}</td>
        `;
        tbody.appendChild(tr);
      });
    };

    // ê²€ìƒ‰
    document.getElementById('all-site-search').oninput = function() {
      const word = this.value.trim();
      const list = JSON.parse(localStorage.getItem('allSites')||'[]');
      const tbody = document.getElementById('all-site-tbody');
      tbody.innerHTML = '';
      list.filter(site => {
        return [site.name, site.company, site.manager].some(f=>f && f.includes(word));
      }).forEach((site, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="checkbox" class="site-checkbox" data-index="${index}" style="width:16px;height:16px;"></td>
          <td>${site.name||''}</td>
          <td>${site.type||''}</td>
          <td>${site.period||''}</td>
          <td>${site.company||''}</td>
          <td>${site.manager||''}</td>
          <td style="text-align:right;">${site.total||''}</td>
          <td>${site.team||''}</td>
          <td>${site.note||''}</td>
        `;
        tbody.appendChild(tr);
      });
    };

    function validateAndSubmit(event) {
      event.preventDefault();
      const siteName = document.getElementById('siteName').value.trim();
      if (!siteName) {
        alert('í˜„ì¥ëª…ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
        document.getElementById('siteName').focus();
        return false;
      }
      return true;
    }

    document.getElementById('all-site-download-btn').onclick = function() {
      const checkboxes = document.querySelectorAll('.site-checkbox:checked');
      if (checkboxes.length === 0) {
        alert('ë‹¤ìš´ë¡œë“œí•  í˜„ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      const list = JSON.parse(localStorage.getItem('allSites')||'[]');
      const selected = Array.from(checkboxes).map(cb => list[parseInt(cb.dataset.index)]);
      // í‘œ ë°ì´í„° ìƒì„±
      const header = ['í˜„ì¥ëª…','ê³„ì•½êµ¬ë¶„','ê³µì‚¬ê¸°ê°„','íšŒì‚¬','ì†Œì¥','ê³„ì•½ê¸ˆì•¡','ì‹œê³µíŒ€','ë¹„ê³ '];
      const rows = selected.map(site => [
        site.name||'',
        site.type||'',
        site.period||'',
        site.company||'',
        site.manager||'',
        site.total||'',
        site.team||'',
        site.note||''
      ]);
      const ws_data = [header, ...rows];
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'ì„ íƒí˜„ì¥');
      XLSX.writeFile(wb, 'ì„ íƒí˜„ì¥ë¦¬ìŠ¤íŠ¸.xlsx');
    };

    function renderStatusSiteLists() {
      // localStorage ì ‘ê·¼ ìµœì†Œí™”
      const allSitesRaw = localStorage.getItem('allSites');
      const list = allSitesRaw ? JSON.parse(allSitesRaw) : [];
      // ì§„í–‰ì¤‘
      const inprogress = list.filter(site => site.status === 'ì§„í–‰ì¤‘');
      // ì˜ˆì •
      const planned = list.filter(site => site.status === 'ì˜ˆì •');
      // ì™„ë£Œ
      const done = list.filter(site => site.status === 'ì™„ë£Œ');
      // ê° ë¦¬ìŠ¤íŠ¸ì— ë Œë”ë§
      function renderToBox(target, arr) {
        target.innerHTML = '';
        arr.forEach(site => {
          const div = document.createElement('div');
          div.className = 'site-list-item';
          div.textContent = site.name;
          div.style.cursor = 'pointer';
          div.onclick = function() {
            // í¼ì— ë°ì´í„° ì…ë ¥
            const form = document.querySelector('.site-detail-form form');
            form.querySelector('#siteName').value = site.name || '';
            form.querySelectorAll('input[type="text"]')[1].value = site.address || '';
            if(site.period) {
              const [start, end] = site.period.split('~').map(d => d.trim());
              form.querySelectorAll('input[type="text"]')[2].value = start || '';
              form.querySelectorAll('input[type="text"]')[3].value = end || '';
            }
            document.getElementById('site-type').value = site.type || 'NONE';
            document.getElementById('site-status').value = site.status || 'ì˜ˆì •';
            form.querySelectorAll('input[type="text"]')[4].value = site.company || '';
            form.querySelectorAll('input[type="text"]')[5].value = site.team || '';
            form.querySelectorAll('input[type="text"]')[6].value = site.manager || '';
            form.querySelectorAll('input[type="text"]')[7].value = site.note || '';
          };
          target.appendChild(div);
        });
      }
      renderToBox(document.querySelectorAll('.site-list-scroll')[0], inprogress);
      renderToBox(document.querySelectorAll('.site-list-scroll')[1], planned);
      renderToBox(document.querySelectorAll('.site-list-scroll')[2], done);
    }

    function afterSiteSave() {
      renderStatusSiteLists();
      renderAllSiteList();
    }

    document.getElementById('all-site-delete-btn').onclick = function() {
      const checkboxes = document.querySelectorAll('.site-checkbox:checked');
      if (checkboxes.length === 0) {
        alert('ì‚­ì œí•  í˜„ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      // ì»¤ìŠ¤í…€ ì˜ˆ/ì•„ë‹ˆì˜¤ íŒì—…
      const confirmBg = document.createElement('div');
      confirmBg.style.position = 'fixed';
      confirmBg.style.left = 0;
      confirmBg.style.top = 0;
      confirmBg.style.right = 0;
      confirmBg.style.bottom = 0;
      confirmBg.style.background = 'rgba(0,0,0,0.15)';
      confirmBg.style.zIndex = 9999;
      confirmBg.style.display = 'flex';
      confirmBg.style.alignItems = 'center';
      confirmBg.style.justifyContent = 'center';
      const confirmBox = document.createElement('div');
      confirmBox.style.background = '#fff';
      confirmBox.style.borderRadius = '12px';
      confirmBox.style.boxShadow = '0 4px 24px #1976d233';
      confirmBox.style.padding = '2rem 2.5rem 1.5rem 2.5rem';
      confirmBox.style.textAlign = 'center';
      confirmBox.innerHTML = `
        <div style="font-size:1.15rem;font-weight:500;color:#1976d2;margin-bottom:1.2rem;">í˜„ì¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
        <button id="confirm-yes" style="background:#e53935;color:#fff;border:none;border-radius:6px;padding:0.6rem 1.3rem;font-size:1rem;font-weight:500;cursor:pointer;margin-right:1.2rem;">ì˜ˆ</button>
        <button id="confirm-no" style="background:#1976d2;color:#fff;border:none;border-radius:6px;padding:0.6rem 1.3rem;font-size:1rem;font-weight:500;cursor:pointer;">ì•„ë‹ˆì˜¤</button>
      `;
      confirmBg.appendChild(confirmBox);
      document.body.appendChild(confirmBg);
      document.getElementById('confirm-yes').onclick = function() {
        let list = JSON.parse(localStorage.getItem('allSites')||'[]');
        const indexesToDelete = Array.from(checkboxes).map(cb => parseInt(cb.dataset.index)).sort((a, b) => b - a);
        indexesToDelete.forEach(index => {
          list.splice(index, 1);
        });
        localStorage.setItem('allSites', JSON.stringify(list));
        renderAllSiteList();
        if (typeof renderStatusSiteLists === 'function') renderStatusSiteLists();
        document.body.removeChild(confirmBg);
        alert('ì„ íƒí•œ í˜„ì¥ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      };
      document.getElementById('confirm-no').onclick = function() {
        document.body.removeChild(confirmBg);
      };
    };

    // í˜‘ì˜í•˜ê¸° ë©”ë‰´ í´ë¦­ ì‹œ í™”ë©´ ì „í™˜
    const menuDiscuss = document.getElementById('menu-discussion');
    if(menuDiscuss) {
      menuDiscuss.onclick = function() {
        document.querySelectorAll('section').forEach(s => s.style.display = 'none');
        document.getElementById('discussion-section').style.display = 'block';
        renderDiscussionList();
        renderDiscussionSiteSelect();
        renderDiscussionMemoList();
      };
    }

    // ì €ì¥ëª©ë¡ LIST ë Œë”ë§
    function renderDiscussionList() {
      const list = JSON.parse(localStorage.getItem('discussionList')||'[]');
      const memos = JSON.parse(localStorage.getItem('discussionMemos')||'{}');
      const tbody = document.getElementById('discussion-list-tbody');
      tbody.innerHTML = '';
      list.forEach((item, idx) => {
        const count = (memos[item.site]||[]).length;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="site-index" style="cursor:pointer;">${idx+1}</td>
          <td class="site-name" style="cursor:pointer;">${item.site||''}</td>
          <td>${count}ê¸€</td>
          <td><input type='text' value='${item.etc||''}' style='width:90px;'></td>
        `;
        // ë¹„ê³  ìë™ ì €ì¥
        tr.querySelector('input').onchange = function() {
          item.etc = this.value;
          localStorage.setItem('discussionList', JSON.stringify(list));
        };
        // í˜„ì¥ëª…/ë²ˆí˜¸ í´ë¦­ ì‹œ í•´ë‹¹ ë©”ì‹œì§€ í‘œì‹œ
        tr.querySelector('.site-index').onclick =
        tr.querySelector('.site-name').onclick = function(e) {
          e.stopPropagation();
          renderDiscussionMemoList(item.site);
        };
        tbody.appendChild(tr);
      });
    }

    // ì˜¤ë¥¸ìª½ í˜„ì¥ ì„ íƒ ë“œë¡­ë‹¤ìš´
    function renderDiscussionSiteSelect() {
      const allSites = JSON.parse(localStorage.getItem('allSites')||'[]');
      const select = document.getElementById('discussion-site-select');
      select.innerHTML = '<option value="">í˜„ì¥ ì„ íƒ</option>';
      allSites.forEach(site => {
        select.innerHTML += `<option value="${site.name}">${site.name}</option>`;
      });
    }

    // ì°¾ê¸° ë²„íŠ¼: ì„ íƒëœ í˜„ì¥ëª…ìœ¼ë¡œ ì™¼ìª½ ëª©ë¡ì— ì¶”ê°€
    const findBtn = document.getElementById('discussion-find-btn');
    if(findBtn) {
      findBtn.onclick = function() {
        const select = document.getElementById('discussion-site-select');
        const name = select.value;
        if(!name) { alert('í˜„ì¥ì„ ì„ íƒí•˜ì„¸ìš”.'); return; }
        const list = JSON.parse(localStorage.getItem('discussionList')||'[]');
        if(list.find(item=>item.site===name)) { alert('ì´ë¯¸ ì¶”ê°€ëœ í˜„ì¥ì…ë‹ˆë‹¤.'); return; }
        list.push({site:name, summary:'', etc:''});
        localStorage.setItem('discussionList', JSON.stringify(list));
        renderDiscussionList();
      };
    }

    // ìƒˆë¡œ ë§Œë“¤ê¸°: ì˜¤ë¥¸ìª½ ì…ë ¥ ì´ˆê¸°í™”
    const newBtn = document.getElementById('discussion-new-btn');
    if(newBtn) {
      newBtn.onclick = function() {
        document.getElementById('discussion-site-select').value = '';
        document.getElementById('discussion-memo').value = '';
        document.getElementById('discussion-photo').value = '';
      };
    }

    // ì „ì†¡: ë©”ëª¨ ì €ì¥ ë° ëª©ë¡ í‘œì‹œ
    const sendBtn = document.getElementById('discussion-send-btn');
    if(sendBtn) {
      sendBtn.onclick = function() {
        const site = document.getElementById('discussion-site-select').value;
        const memo = document.getElementById('discussion-memo').value.trim();
        if(!site) { alert('í˜„ì¥ì„ ì„ íƒí•˜ì„¸ìš”.'); return; }
        if(!memo) { alert('ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
        const photo = document.getElementById('discussion-photo').files[0];
        const memos = JSON.parse(localStorage.getItem('discussionMemos')||'{}');
        if(!memos[site]) memos[site] = [];
        let photoUrl = '';
        if(photo) {
          const reader = new FileReader();
          reader.onload = function(e) {
            photoUrl = e.target.result;
            memos[site].push({memo, photo:photoUrl, date:new Date().toLocaleString()});
            localStorage.setItem('discussionMemos', JSON.stringify(memos));
            updateDiscussionList(site, memos[site].length);
            renderDiscussionMemoList(site);
            document.getElementById('discussion-memo').value = '';
            document.getElementById('discussion-photo').value = '';
          };
          reader.readAsDataURL(photo);
          return;
        }
        memos[site].push({memo, photo:'', date:new Date().toLocaleString()});
        localStorage.setItem('discussionMemos', JSON.stringify(memos));
        updateDiscussionList(site, memos[site].length);
        renderDiscussionMemoList(site);
        document.getElementById('discussion-memo').value = '';
        document.getElementById('discussion-photo').value = '';
      };
    }

    // ì €ì¥ëª©ë¡ ë¦¬ìŠ¤íŠ¸ ìë™ ì¶”ê°€ ë° ê¸€ ìˆ˜ ê°±ì‹ 
    function updateDiscussionList(site, count) {
      const list = JSON.parse(localStorage.getItem('discussionList')||'[]');
      let item = list.find(i => i.site === site);
      if(item) {
        item.memoCount = count;
      } else {
        list.push({site, memoCount: count, etc: ''});
      }
      localStorage.setItem('discussionList', JSON.stringify(list));
      renderDiscussionList();
    }

    // ë©”ëª¨ ëª©ë¡ ë Œë”ë§ (ìµœì‹ ìˆœ, í˜„ì¥ëª… í‘œì‹œ)
    function renderDiscussionMemoList(site) {
      const memos = JSON.parse(localStorage.getItem('discussionMemos')||'{}');
      const box = document.getElementById('discussion-memo-list');
      const siteTitle = document.getElementById('discussion-selected-site');
      siteTitle.textContent = site ? site : '';
      box.innerHTML = '';
      if(!site || !memos[site] || memos[site].length===0) return;
      // ìµœì‹ ìˆœ(ìœ„ì—ì„œ ì•„ë˜ë¡œ)
      const recentMemos = [...memos[site]].reverse();
      recentMemos.forEach(item => {
        const div = document.createElement('div');
        div.style = 'margin-bottom:1.2rem;padding:1rem;background:#f7fafd;border-radius:8px;box-shadow:0 1px 4px #1976d211;';
        div.innerHTML = `<div style='font-size:0.98rem;color:#1976d2;font-weight:500;'>${item.memo}</div>` +
          (item.photo ? `<img src='${item.photo}' style='max-width:120px;display:block;margin:0.5rem 0;'>` : '') +
          `<div style='font-size:0.85rem;color:#888;'>${item.date}</div>`;
        box.appendChild(div);
      });
    }

    // í˜„ì¥ ì„ íƒ ì‹œ í˜„ì¥ëª… í‘œì‹œ ë° ë©”ëª¨ ëª©ë¡ ê°±ì‹ 
    const siteSelect = document.getElementById('discussion-site-select');
    if(siteSelect) {
      siteSelect.onchange = function() {
        renderDiscussionMemoList(this.value);
      };
    }

    // ê¸°ì„±í˜„í™© ë©”ë‰´ í´ë¦­
    const menuProgress = Array.from(document.querySelectorAll('.menu-item')).find(el=>el.textContent.includes('ê¸°ì„±í˜„í™©'));
    if(menuProgress) {
      menuProgress.onclick = function() {
        if(localStorage.getItem('isAdmin', 'isMaster') === 'Y') {
          document.querySelectorAll('section').forEach(s => s.style.display = 'none');
          document.getElementById('progress-section').style.display = 'block';
          renderProgressSiteSelect();
          renderProgressMonthSelect();
          renderProgressMonthTable();
          renderProgressTodayInfo();
          renderProgressSiteTable();
        } else {
          alert('ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        }
      };
    }

    // í˜„ì¥ëª… ë“œë¡­ë‹¤ìš´ ë Œë”ë§
    function renderProgressSiteSelect() {
      const allSites = JSON.parse(localStorage.getItem('allSites')||'[]');
      const select = document.getElementById('progress-site-select');
      select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
      allSites.forEach(site => {
        select.innerHTML += `<option value="${site.name}">${site.name}</option>`;
      });
    }

    // ì›” ì„ íƒ ë“œë¡­ë‹¤ìš´ ë Œë”ë§
    function renderProgressMonthSelect() {
      const now = new Date();
      const select = document.getElementById('progress-month-select');
      select.innerHTML = '';
      for(let i=0;i<12;i++) {
        const d = new Date(now.getFullYear(), now.getMonth()-i, 1);
        const ym = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
        select.innerHTML += `<option value="${ym}"${i===0?' selected':''}>${ym}</option>`;
      }
    }

    // ì›”ë³„ í˜„í™© í‘œ ë Œë”ë§
    function renderProgressMonthTable() {
      const ym = document.getElementById('progress-month-select').value;
      const allSites = JSON.parse(localStorage.getItem('allSites')||'[]');
      const allData = JSON.parse(localStorage.getItem('progressData')||'[]');
      const tbody = document.getElementById('progress-month-tbody');
      tbody.innerHTML = '';
      allSites.forEach(site => {
        const siteData = allData.filter(d => d.site === site.name && d.date.startsWith(ym));
        const contract = site.total ? Number(site.total.replace(/[^\\d]/g, '')) : 0;
        const claim = siteData.filter(d=>d.type==='ì²­êµ¬').reduce((a,c)=>a+Number(c.amount||0),0);
        const pay = siteData.filter(d=>d.type==='ì§€ê¸‰').reduce((a,c)=>a+Number(c.amount||0),0);
        const remain = contract + claim - pay;
        tbody.innerHTML += `<tr><td>${site.name}</td><td>${contract.toLocaleString()}</td><td>${claim.toLocaleString()}</td><td>${pay.toLocaleString()}</td><td>${remain.toLocaleString()}</td></tr>`;
      });
    }

    // TODAY ë°•ìŠ¤ ë Œë”ë§
    function renderProgressTodayInfo() {
      const el = document.getElementById('progress-today-info');
      if (!el) return;
      const today = new Date().toISOString().slice(0,10);
      const allData = JSON.parse(localStorage.getItem('progressData')||'[]');
      const claimCnt = allData.filter(d=>d.type==='ì²­êµ¬'&&d.date===today).length;
      const payCnt = allData.filter(d=>d.type==='ì§€ê¸‰'&&d.date===today).length;
      el.innerHTML = `ì˜¤ëŠ˜ ì²­êµ¬ ì˜ˆì •: ${claimCnt}ê±´<br>ì˜¤ëŠ˜ ì§€ê¸‰ ì˜ˆì •: ${payCnt}ê±´`;
    }

    // í˜„ì¥ë³„ í˜„í™© í‘œ ë Œë”ë§
    function renderProgressSiteTable(keyword) {
      const allSites = JSON.parse(localStorage.getItem('allSites')||'[]');
      const allData = JSON.parse(localStorage.getItem('progressData')||'[]');
      const tbody = document.getElementById('progress-site-tbody');
      tbody.innerHTML = '';
      let sites = allSites;
      if(keyword) sites = sites.filter(site=>site.name.includes(keyword));
      sites.forEach(site => {
        const siteData = allData.filter(d => d.site === site.name);
        const contract = site.total ? Number(site.total.replace(/[^\\d]/g, '')) : 0;
        const claim = siteData.filter(d=>d.type==='ì²­êµ¬').reduce((a,c)=>a+Number(c.amount||0),0);
        const pay = siteData.filter(d=>d.type==='ì§€ê¸‰').reduce((a,c)=>a+Number(c.amount||0),0);
        const remain = contract + claim - pay;
        tbody.innerHTML += `<tr><td>${site.name}</td><td>${contract.toLocaleString()}</td><td>${claim.toLocaleString()}</td><td>${pay.toLocaleString()}</td><td>${remain.toLocaleString()}</td></tr>`;
      });
    }

    // ì›” ì„ íƒ ë³€ê²½ ì‹œ í‘œ ê°±ì‹   
    const monthSelect = document.getElementById('progress-month-select');  
    if(monthSelect) monthSelect.onchange = renderProgressMonthTable;  
    // í˜„ì¥ë³„ í˜„í™© ê²€ìƒ‰  
    const searchBtn = document.getElementById('progress-search-btn');  
    if(searchBtn) {  
      searchBtn.onclick = function() {  
        const keyword = document.getElementById('progress-search-input').value.trim();  
        renderProgressSiteTable(keyword);  
      };  
    }  
    // ì €ì¥ ë²„íŠ¼  
    const saveBtn = document.getElementById('progress-save-btn');  
    if(saveBtn) {  
      saveBtn.onclick = function() {  
        const site = document.getElementById('progress-site-select').value;  
        const type = document.getElementById('progress-type-select').value;  
        const kind = document.getElementById('progress-kind-select').value;  
        const amount = document.getElementById('progress-amount').value;  
        const date = document.getElementById('progress-date').value;  
        const note = document.getElementById('progress-note').value;  
        if(!site||!type||!kind||!amount||!date) { alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }  
        const allData = JSON.parse(localStorage.getItem('progressData')||'[]');  
        allData.push({site,type,kind,amount,date,note});  
        localStorage.setItem('progressData', JSON.stringify(allData));  
        renderProgressMonthTable();  
        renderProgressTodayInfo();  
        renderProgressSiteTable();  
        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');  
      };  
    }  

    // ê¸°ì„±í˜„í™© LIST ë²„íŠ¼ í´ë¦­ ì‹œ í™”ë©´ ì „í™˜
    document.getElementById('progress-list-btn').onclick = function() {
      document.getElementById('progress-section').style.display = 'none';
      document.getElementById('progress-list-section').style.display = 'block';
      renderProgressList();
    };

    // ëŒì•„ê°€ê¸° ë²„íŠ¼
    document.getElementById('progress-list-back-btn').onclick = function() {
      document.getElementById('progress-list-section').style.display = 'none';
      document.getElementById('progress-section').style.display = 'block';
    };

    // ê¸°ì„±í˜„í™© LIST ë Œë”ë§
    function renderProgressList() {
      const list = JSON.parse(localStorage.getItem('progressData')||'[]');
      const tbody = document.getElementById('progress-list-tbody');
      tbody.innerHTML = '';
      list.forEach(item => {
        tbody.innerHTML += `<tr>
          <td>${item.site||''}</td>
          <td>${item.type||''}</td>
          <td>${item.kind||''}</td>
          <td>${item.amount||''}</td>
          <td>${item.date||''}</td>
          <td>${item.note||''}</td>
        </tr>`;
      });
    }

    function updateMemoCount(site) {
      const list = JSON.parse(localStorage.getItem('discussionList')||'[]');
      const memos = JSON.parse(localStorage.getItem('discussionMemos')||'{}');
      const item = list.find(i => i.site === site);
      if(item) {
        // ì´ë¯¸ ìˆìœ¼ë©´ countë§Œ ê°±ì‹ 
        item.memoCount = (memos[site]||[]).length;
      } else {
        // ì—†ìœ¼ë©´ ìƒˆë¡œ ì¶”ê°€
        list.push({site, memoCount: (memos[site]||[]).length, etc: ''});
      }
      localStorage.setItem('discussionList', JSON.stringify(list));
      renderDiscussionList();
    }

  
    // ê±°ë˜ì²˜ í˜„í™© ë°ì´í„° ì €ì¥ êµ¬ì¡°
    const companyData = {
      'ê±´ì„¤ì—…ì²´': [],
      'ALê´€ê¸‰ì—…ì²´': [],
      'PLê´€ê¸‰ì—…ì²´': []
    };

    // localStorageì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadCompanyData() {
      const saved = localStorage.getItem('companyData');
      if(saved) {
        const parsed = JSON.parse(saved);
        Object.keys(companyData).forEach(type => {
          companyData[type] = parsed[type] || [];
        });
      }
    }
    // localStorageì— ì €ì¥
    function saveCompanyData() {
      localStorage.setItem('companyData', JSON.stringify(companyData));
    }

    // í…Œì´ë¸” ë Œë”ë§
    function renderCompanyTables() {
      Object.keys(companyData).forEach(type => {
        const box = document.querySelector(`.company-box-vertical[data-type="${type}"]`);
        if(!box) return;
        const tbody = box.querySelector('tbody');
        // ì…ë ¥ í–‰ì´ ìˆìœ¼ë©´ ì‚­ì œ
        const inputRow = tbody.querySelector('.input-row');
        if(inputRow) inputRow.remove();
        tbody.innerHTML = '';
        const sorted = companyData[type].slice().sort((a,b)=>a.date.localeCompare(b.date));
        sorted.forEach((row, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><input type="checkbox" class="company-row-check" data-type="${type}" data-idx="${idx}"></td>
            <td>${row.editing ? `<input type="text" value="${row.name||''}">` : row.name||''}</td>
            <td>${row.editing ? `<input type="date" value="${row.date||''}">` : row.date||''}</td>
            <td>${row.editing ? `<input type="text" value="${row.contract||''}">` : row.contract||''}</td>
            <td style="text-align:right;">${row.editing ? `<input type="number" value="${row.amount||''}">` : row.amount||''}</td>
            <td><input type="text" value="${row.note||''}" class="company-note-input"></td>
            <td>
              <button class="company-edit-btn" data-type="${type}" data-idx="${idx}">${row.editing ? 'ì €ì¥' : 'ìˆ˜ì •'}</button>
              <button class="company-del-btn" data-type="${type}" data-idx="${idx}">ì‚­ì œ</button>
            </td>
          `;
          // ë¹„ê³  ì¸í’‹: í¬ì»¤ìŠ¤ì•„ì›ƒ ì‹œ ë°”ë¡œ ì €ì¥
          tr.querySelector('.company-note-input').onblur = function() {
            companyData[type][idx].note = this.value;
            saveCompanyData();
          };
          // ìˆ˜ì • ë²„íŠ¼
          tr.querySelector('.company-edit-btn').onclick = function() {
            if (!row.editing) {
              companyData[type][idx].editing = true;
              renderCompanyTables();
            } else {
              // ì €ì¥
              const tds = tr.children;
              const name = tds[1].querySelector('input').value.trim();
              const date = tds[2].querySelector('input').value;
              const contract = tds[3].querySelector('input').value.trim();
              const amount = tds[4].querySelector('input').value.trim();
              const note = tds[5].querySelector('input').value.trim();
              if(!name || !contract) {
                alert('ì—…ì²´ëª…, ê³„ì•½ê±´ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
              }
              // ì¤‘ë³µ ì²´í¬
              if (companyData[type].some((r, i) => i !== idx && r.name === name && r.contract === contract)) {
                alert('ë™ì¼í•œ ì—…ì²´ëª…+ê³„ì•½ê±´ëª… ì¡°í•©ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.');
                return;
              }
              companyData[type][idx] = {name, date, contract, amount, note};
              saveCompanyData();
              renderCompanyTables();
            }
          };
          // ì‚­ì œ ë²„íŠ¼
          tr.querySelector('.company-del-btn').onclick = function() {
            if(confirm('í˜„ì¥ì„ ì§€ìš°ê² ìŠµë‹ˆê¹Œ?')) {
              companyData[type].splice(idx, 1);
              saveCompanyData();
              renderCompanyTables();
            }
          };
          tbody.appendChild(tr);
        });
      });
    }

    // ì¤‘ë³µ ì²´í¬(ì—…ì²´ëª…+ê³„ì•½ê±´ëª…)
    function isDuplicate(type, name, contract) {
      return companyData[type].some(row => row.name === name && row.contract === contract);
    }

    // ì—‘ì…€ ì—…ë¡œë“œ
    function handleExcelUpload(type, file) {
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet, {header:1});
        // í—¤ë” ì¸ë±ìŠ¤ ì°¾ê¸°
        let headerIdx = -1;
        for(let i=0;i<json.length;i++) {
          if(json[i].includes('ì—…ì²´ëª…') && json[i].includes('ê³„ì•½ê±´ëª…')) {
            headerIdx = i;
            break;
          }
        }
        if(headerIdx === -1) { alert('ì—‘ì…€ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
        // í—¤ë” ë§¤í•‘
        const header = json[headerIdx];
        const nameIdx = header.indexOf('ì—…ì²´ëª…');
        const dateIdx = header.indexOf('ë‚©í’ˆê¸°í•œì¼ì');
        const contractIdx = header.indexOf('ê³„ì•½ê±´ëª…');
        const amountIdx = header.indexOf('ê¸ˆì•¡');
        const noteIdx = header.indexOf('ë¹„ê³ ');
        // ì¤‘ë³µ ì²´í¬ìš© Set
        const uniqueKeys = new Set();
        // ë°ì´í„° ì¶”ì¶œ
        for(let i=headerIdx+1;i<json.length;i++) {
          const row = json[i];
          const name = row[nameIdx] ? row[nameIdx]+'' : '';
          const date = row[dateIdx] ? row[dateIdx]+'' : '';
          const contract = row[contractIdx] ? row[contractIdx]+'' : '';
          const amount = row[amountIdx] ? row[amountIdx]+'' : '';
          const note = row[noteIdx] ? row[noteIdx]+'' : '';
          if(!name || !contract) continue; // í•„ìˆ˜ê°’
          // ì¤‘ë³µ ì²´í¬: ì—…ì²´ëª…+ê³„ì•½ê±´ëª… ì¡°í•©
          const key = `${name}|${contract}`;
          if(uniqueKeys.has(key)) continue; // ì´ë¯¸ ìˆìœ¼ë©´ ê±´ë„ˆë›°ê¸°
          uniqueKeys.add(key);
          if(isDuplicate(type, name, contract)) continue; // ê¸°ì¡´ DB ì¤‘ë³µ ë°©ì§€
          companyData[type].push({name, date, contract, amount, note});
        }
        saveCompanyData();
        renderCompanyTables();
      };
      reader.readAsArrayBuffer(file);
    }

    // ì˜¬ë¦¬ê¸° ë²„íŠ¼
    let uploadTargetType = null;
    document.querySelector('.company-upload-btn').onclick = function() {
      // ì¹´í…Œê³ ë¦¬ ì„ íƒ ëª¨ë‹¬
      const type = prompt('ì–´ëŠ ì—…ì²´ì— ì˜¬ë¦´ê¹Œìš”?\n1. ê±´ì„¤ì—…ì²´\n2. ALê´€ê¸‰ì—…ì²´\n3. PLê´€ê¸‰ì—…ì²´\n\në²ˆí˜¸ ë˜ëŠ” ì´ë¦„ ì…ë ¥');
      if(!type || !companyData[type]) { alert('ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤.'); return; }
      uploadTargetType = type;
      document.getElementById('company-excel-input').click();
    };
    document.getElementById('company-excel-input').onchange = function(e) {
      if(uploadTargetType) {
        handleExcelUpload(uploadTargetType, e.target.files[0]);
        uploadTargetType = null;
        e.target.value = '';
      }
    };

    // ë‚´ë ¤ë°›ê¸° ë²„íŠ¼
    function downloadCompanyExcel() {
      let rows = [];
      Object.keys(companyData).forEach(type => {
        const box = document.querySelector(`.company-box-vertical[data-type="${type}"]`);
        if(!box) return;
        const checks = box.querySelectorAll('.company-row-check:checked');
        checks.forEach(chk => {
          const idx = parseInt(chk.dataset.idx);
          const row = companyData[type][idx];
          rows.push([type, row.name, row.date, row.contract, row.amount, row.note]);
        });
      });
      if(rows.length===0) { alert('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
      const ws = XLSX.utils.aoa_to_sheet([
        ['êµ¬ë¶„','ì—…ì²´ëª…','ë‚©í’ˆê¸°í•œì¼ì','ê³„ì•½ê±´ëª…','ê¸ˆì•¡','ë¹„ê³ '],
        ...rows
      ]);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'ê±°ë˜ì²˜í˜„í™©');
      XLSX.writeFile(wb, 'ê±°ë˜ì²˜í˜„í™©.xlsx');
    }
    document.querySelector('.company-download-btn').onclick = downloadCompanyExcel;

    // ì‚­ì œ ë²„íŠ¼
    function deleteCompanyRows() {
      let hasChecked = false;
      let checkedRows = [];
      Object.keys(companyData).forEach(type => {
        const box = document.querySelector(`.company-box-vertical[data-type="${type}"]`);
        if(!box) return;
        const checks = box.querySelectorAll('.company-row-check:checked');
        if(checks.length > 0) {
          hasChecked = true;
          checkedRows.push({ type, idxs: Array.from(checks).map(chk => parseInt(chk.dataset.idx)) });
        }
      });
      if(!hasChecked) {
        alert('ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }
      if(!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      // ì‹¤ì œ ì‚­ì œ (ë’¤ì—ì„œë¶€í„° ì‚­ì œí•´ì•¼ ì¸ë±ìŠ¤ ê¼¬ì„ ë°©ì§€)
      checkedRows.forEach(({type, idxs}) => {
        idxs.sort((a, b) => b - a).forEach(idx => {
          companyData[type].splice(idx, 1);
        });
      });
      saveCompanyData();
      renderCompanyTables();
    }
    document.querySelector('.company-delete-btn').onclick = deleteCompanyRows;

    // ì¶”ê°€ ë²„íŠ¼
    document.querySelector('.company-add-btn').onclick = function() {
      // ì¹´í…Œê³ ë¦¬ ì„ íƒ ëª¨ë‹¬
      const type = prompt('ì–´ëŠ ì—…ì²´ì— ì¶”ê°€í• ê¹Œìš”?\n1. ê±´ì„¤ì—…ì²´\n2. ALê´€ê¸‰ì—…ì²´\n3. PLê´€ê¸‰ì—…ì²´\n\në²ˆí˜¸ ë˜ëŠ” ì´ë¦„ ì…ë ¥');
      let typeName = '';
      if(type === '1' || type === 'ê±´ì„¤ì—…ì²´') typeName = 'ê±´ì„¤ì—…ì²´';
      else if(type === '2' || type === 'ALê´€ê¸‰ì—…ì²´') typeName = 'ALê´€ê¸‰ì—…ì²´';
      else if(type === '3' || type === 'PLê´€ê¸‰ì—…ì²´') typeName = 'PLê´€ê¸‰ì—…ì²´';
      else { alert('ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤.'); return; }

      // ì´ë¯¸ ì…ë ¥ì¤‘ì¸ í–‰ì´ ìˆìœ¼ë©´ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
      const box = document.querySelector(`.company-box-vertical[data-type="${typeName}"]`);
      if(box.querySelector('tr.input-row')) {
        alert('ì´ë¯¸ ì…ë ¥ì¤‘ì¸ í–‰ì´ ìˆìŠµë‹ˆë‹¤.');
        return;
      }
      // ë§¨ ìœ„ì— ì…ë ¥ í–‰ ì¶”ê°€
      const tbody = box.querySelector('tbody');
      const tr = document.createElement('tr');
      tr.className = 'input-row';
      tr.innerHTML = `
        <td></td>
        <td><input type="text" placeholder="ì—…ì²´ëª…"></td>
        <td><input type="date"></td>
        <td><input type="text" placeholder="ê³„ì•½ê±´ëª…"></td>
        <td><input type="number" placeholder="ê¸ˆì•¡" style="text-align:right;"></td>
        <td><input type="text" placeholder="ë¹„ê³ "></td>
        <td><button class="company-save-btn">ì €ì¥</button></td>
      `;
      tbody.insertBefore(tr, tbody.firstChild);

      // ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸
      tr.querySelector('.company-save-btn').onclick = function() {
        const name = tr.children[1].querySelector('input').value.trim();
        const date = tr.children[2].querySelector('input').value; // ë¹„ì–´ìˆì–´ë„ ë¨
        const contract = tr.children[3].querySelector('input').value.trim();
        const amount = tr.children[4].querySelector('input').value.trim(); // ë¹„ì–´ìˆì–´ë„ ë¨
        const note = tr.children[5].querySelector('input').value.trim();
        if(!name || !contract) {
          alert('ì—…ì²´ëª…, ê³„ì•½ê±´ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
          return;
        }
        if(isDuplicate(typeName, name, contract)) {
          alert('ë™ì¼í•œ ì—…ì²´ëª…+ê³„ì•½ê±´ëª… ì¡°í•©ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.');
          return;
        }
        companyData[typeName].unshift({name, date, contract, amount, note});
        saveCompanyData();
        renderCompanyTables(); // ì…ë ¥í¼ ìë™ ì‚­ì œ ë° ëª©ë¡ ê°±ì‹ 
      };
    };

    // ì§ì ‘ ì…ë ¥ ì €ì¥(ì…€ ë”ë¸”í´ë¦­ â†’ ì…ë ¥ â†’ í¬ì»¤ìŠ¤ì•„ì›ƒ ì‹œ ì €ì¥)
    document.addEventListener('dblclick', function(e) {
      if(e.target.tagName==='TD' && e.target.parentElement.parentElement.parentElement.classList.contains('company-table')) {
        const td = e.target;
        const tr = td.parentElement;
        const table = tr.parentElement.parentElement;
        const type = table.closest('.company-box').dataset.type;
        const idx = Array.from(tr.parentElement.children).indexOf(tr);
        const keyMap = ['name','date','contract','amount','note'];
        const colIdx = Array.from(tr.children).indexOf(td)-1;
        if(colIdx<0||colIdx>4) return;
        const old = td.textContent;
        td.innerHTML = `<input type='text' value='${old}' style='width:90%;'>`;
        const input = td.querySelector('input');
        input.focus();
        input.onblur = function() {
          const val = input.value.trim();
          // ì¤‘ë³µ ì²´í¬
          if(keyMap[colIdx]==='name'||keyMap[colIdx]==='contract') {
            const name = keyMap[colIdx]==='name'?val:tr.children[1].textContent;
            const contract = keyMap[colIdx]==='contract'?val:tr.children[3].textContent;
            if(isDuplicate(type, name, contract)) {
              alert('ë™ì¼í•œ ì—…ì²´ëª…+ê³„ì•½ê±´ëª… ì¡°í•©ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.');
              td.textContent = old;
              return;
            }
          }
          companyData[type][idx][keyMap[colIdx]] = val;
          saveCompanyData();
          renderCompanyTables();
        };
      }
    });

    // ê²€ìƒ‰(ì°¾ê¸°)
    document.querySelectorAll('.company-find-btn').forEach(btn => {
      btn.onclick = function() {
        const box = btn.closest('.company-box');
        const type = box.dataset.type;
        const word = box.querySelector('.company-search').value.trim();
        const tbody = box.querySelector('tbody');
        tbody.innerHTML = '';
        const filtered = companyData[type].filter(row => Object.values(row).some(v=>v&&v.includes(word)));
        filtered.sort((a,b)=>a.date.localeCompare(b.date));
        filtered.forEach((row, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><input type="checkbox" class="company-row-check" data-type="${type}" data-idx="${idx}"></td>
            <td>${row.name||''}</td>
            <td>${row.date||''}</td>
            <td>${row.contract||''}</td>
            <td style="text-align:right;">${row.amount||''}</td>
            <td>${row.note||''}</td>
            <td>
              <button class="company-up-btn" data-type="${type}" data-idx="${idx}">â–²</button>
              <button class="company-down-btn" data-type="${type}" data-idx="${idx}">â–¼</button>
              <button class="company-del-btn" data-type="${type}" data-idx="${idx}">ì‚­ì œ</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      };
    });

    // ìˆœì„œ ë³€ê²½/ì‚­ì œ ë²„íŠ¼
    // ... (ì¶”í›„ ì¶”ê°€)

    // ë©”ë‰´ì— ê±°ë˜ì²˜ í˜„í™© ê´€ë¦¬ ì§„ì… ë²„íŠ¼ ì¶”ê°€(ì„ì‹œ)
    const menuCompany = document.createElement('div');
    menuCompany.className = 'menu-item';
    menuCompany.textContent = 'ê±°ë˜ì²˜ í˜„í™©';
    document.querySelector('.menu').appendChild(menuCompany);
    menuCompany.onclick = function() {
      document.querySelectorAll('section').forEach(s => s.style.display = 'none');
      document.getElementById('company-section').style.display = 'block';
      loadCompanyData();
      renderCompanyTables();
    };

    // í˜ì´ì§€ ë¡œë“œì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    loadCompanyData();

    document.getElementById('discussion-list-check-all').onclick = function() {
      const checked = this.checked;
      document.querySelectorAll('.discussion-list-row-check').forEach(cb => {
        cb.checked = checked;
      });
    };

    document.getElementById('discussion-list-delete-btn').onclick = function() {
      let list = JSON.parse(localStorage.getItem('discussionList')||'[]');
      let memos = JSON.parse(localStorage.getItem('discussionMemos')||'{}');
      const checks = document.querySelectorAll('.discussion-list-row-check:checked');
      if(checks.length === 0) {
        alert('ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }
      if(!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      // ì‚­ì œí•  siteëª… ëª©ë¡ ì¶”ì¶œ
      const idxs = Array.from(checks).map(cb=>parseInt(cb.dataset.idx)).sort((a,b)=>b-a);
      const siteNames = idxs.map(idx => list[idx].site);
      // ëª©ë¡ì—ì„œ ì‚­ì œ
      idxs.forEach(idx => list.splice(idx,1));
      // ë©”ëª¨ë„ ê°™ì´ ì‚­ì œ
      siteNames.forEach(site => {
        if(memos[site]) delete memos[site];
      });
      localStorage.setItem('discussionList', JSON.stringify(list));
      localStorage.setItem('discussionMemos', JSON.stringify(memos));
      renderDiscussionList();
      // ì˜¤ë¥¸ìª½ ë©”ëª¨ì°½ë„ ë¹„ì›Œì¤Œ(ì„ íƒëœ í˜„ì¥ì´ ì‚­ì œëœ ê²½ìš°)
      const selected = document.getElementById('discussion-site-select').value;
      if(selected && siteNames.includes(selected)) {
        document.getElementById('discussion-selected-site').textContent = '';
        document.getElementById('discussion-memo-list').innerHTML = '';
      }
    };

    // ë¡œê·¸ì¸ ê´€ë ¨ í•¨ìˆ˜ë“¤
    function checkLogin() {
      const isLogin = localStorage.getItem('isLogin') === 'Y';
      const isMaster = localStorage.getItem('isMaster') === 'Y';
      const isAdmin = localStorage.getItem('isAdmin') === 'Y';
      
      const loginForm = document.getElementById('login-form');
      const mainContent = document.getElementById('main-content');
      const userInfo = document.getElementById('user-info');
      const progressTab = document.getElementById('progress-tab');
      
      if (loginForm) loginForm.style.display = isLogin ? 'none' : 'block';
      if (mainContent) mainContent.style.display = isLogin ? 'block' : 'none';
      if (userInfo) userInfo.style.display = isLogin ? 'block' : 'none';
      if (progressTab) progressTab.style.display = (isMaster || isAdmin) ? 'block' : 'none';
      
      if(isLogin) {
        const currentUserId = localStorage.getItem('currentUserId');
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const user = users.find(u => u.id === currentUserId);
        if(user) {
          const userName = document.getElementById('user-name');
          const userRole = document.getElementById('user-role');
          if (userName) userName.textContent = user.name;
          if (userRole) userRole.textContent = isMaster ? 'ë§ˆìŠ¤í„°' : (isAdmin ? 'ê´€ë¦¬ì' : 'ì¼ë°˜');
        }
      }
    }

    // ë¡œê·¸ì¸ í¼ ì œì¶œ ì´ë²¤íŠ¸
    document.getElementById('login-form').onsubmit = function(e) {
      e.preventDefault();
      const id = document.getElementById('login-id').value.trim();
      const pw = document.getElementById('login-pw').value.trim();
      
      // ë§ˆìŠ¤í„° ê³„ì •
      if(id === 'fire8803' && pw === 'power520!!') {
        localStorage.setItem('isLogin', 'Y');
        localStorage.setItem('isMaster', 'Y');
        localStorage.setItem('currentUserId', id);
        sessionStorage.setItem('isLoginSession', 'Y');
        checkLogin();
        return;
      }
      
      // ì¼ë°˜ íšŒì› ë¡œê·¸ì¸ ì²˜ë¦¬
      const memberData = JSON.parse(localStorage.getItem('memberData') || '{"admin":[],"user":[],"request":[]}');
      const allMembers = [...memberData.admin, ...memberData.user, ...memberData.request];
      const member = allMembers.find(m => m.id === id && m.pw === pw);
      
      if(member) {
        localStorage.setItem('isLogin', 'Y');
        localStorage.setItem('isAdmin', member.role === 'ê´€ë¦¬ì' ? 'Y' : 'N');
        localStorage.setItem('isMaster', member.role === 'ë§ˆìŠ¤í„°' ? 'Y' : 'N');
        localStorage.setItem('currentUserId', id);
        sessionStorage.setItem('isLoginSession', 'Y');
        checkLogin();
        return;
      }
      
      document.getElementById('login-error').style.display = 'block';
    };

    // í˜ì´ì§€ ë¡œë“œì‹œ ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬
    document.addEventListener('DOMContentLoaded', function() {
      // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ë¡œê·¸ì¸ ìƒíƒœê°€ ì—†ìœ¼ë©´ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
      if(localStorage.getItem('isLogin') === 'Y' && !sessionStorage.getItem('isLoginSession')) {
        localStorage.removeItem('isLogin');
        localStorage.removeItem('isMaster');
        localStorage.removeItem('isAdmin');
        localStorage.removeItem('currentUserId');
      }
      checkLogin();
      renderSiteList();
      renderCalendar();
      renderStatusSiteLists();
    });

    // ì°½/íƒ­ ë‹«í ë•Œ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ
    window.addEventListener('beforeunload', function() {
      sessionStorage.removeItem('isLoginSession');
    });

    // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
    document.getElementById('logout-btn').onclick = function() {
      localStorage.removeItem('isLogin');
      localStorage.removeItem('isMaster');
      localStorage.removeItem('isAdmin');
      localStorage.removeItem('currentUserId');
      sessionStorage.removeItem('isLoginSession');
      location.reload();
    };

    // ì¹´í…Œê³ ë¦¬ë³„ ì°¾ê¸° ë²„íŠ¼ ë° ì—”í„°í‚¤ ì´ë²¤íŠ¸
    document.querySelectorAll('.company-box-vertical').forEach(box => {
      const type = box.dataset.type;
      const searchInput = box.querySelector('.company-search');
      const findBtn = box.querySelector('.company-find-btn');
      const tbody = box.querySelector('tbody');

      // ê²€ìƒ‰ í•¨ìˆ˜
      function doSearch() {
        const word = searchInput.value.trim();
        tbody.innerHTML = '';
        let filtered;
        if (word === '') {
          // ê²€ìƒ‰ì–´ ì—†ìœ¼ë©´ ì „ì²´
          filtered = companyData[type];
        } else {
          filtered = companyData[type].filter(row =>
            Object.values(row).some(v => v && v.toString().includes(word))
          );
        }
        filtered.sort((a, b) => a.date.localeCompare(b.date));
        filtered.forEach((row, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><input type="checkbox" class="company-row-check" data-type="${type}" data-idx="${idx}"></td>
            <td>${row.name||''}</td>
            <td>${row.date||''}</td>
            <td>${row.contract||''}</td>
            <td style="text-align:right;">${row.amount||''}</td>
            <td><input type="text" value="${row.note||''}" class="company-note-input"></td>
            <td>
              <button class="company-edit-btn" data-type="${type}" data-idx="${idx}">${row.editing ? 'ì €ì¥' : 'ìˆ˜ì •'}</button>
              <button class="company-del-btn" data-type="${type}" data-idx="${idx}">ì‚­ì œ</button>
            </td>
          `;
          // ë¹„ê³  ì¸í’‹: í¬ì»¤ìŠ¤ì•„ì›ƒ ì‹œ ë°”ë¡œ ì €ì¥
          tr.querySelector('.company-note-input').onblur = function() {
            companyData[type][idx].note = this.value;
            saveCompanyData();
          };
          // ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ë“± ê¸°ì¡´ ì´ë²¤íŠ¸ë„ ì—¬ê¸°ì— ì¶”ê°€ í•„ìš”
          // ... (ìƒëµ, ê¸°ì¡´ renderCompanyTables ì°¸ê³ )
          tbody.appendChild(tr);
        });
      }

      // ì°¾ê¸° ë²„íŠ¼ í´ë¦­
      findBtn.onclick = doSearch;

      // ì—”í„°í‚¤ë¡œë„ ê²€ìƒ‰
      searchInput.onkeydown = function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          doSearch();
        }
      };
    });

    document.getElementById('progress-template-btn').onclick = function() {
      const ws = XLSX.utils.aoa_to_sheet([
        ['í˜„ì¥ëª…', 'êµ¬ë¶„', 'ê³„ì‚°ì„œìœ ë¬´', 'ê¸ˆì•¡', 'ë‚ ì§œ', 'ë¹„ê³ '],
        ['í˜„ì¥A', 'ì²­êµ¬', 'ê³„ì‚°ì„œ', '1000000', '2025-05-01', 'ë¹„ê³ 1'],
        ['í˜„ì¥B', 'ì§€ê¸‰', 'ë…¸ë¬´ë¹„', '500000', '2025-05-02', 'ë¹„ê³ 2']
      ]);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'ê¸°ì„±í˜„í™©ì–‘ì‹');
      XLSX.writeFile(wb, 'ê¸°ì„±í˜„í™©ì–‘ì‹.xlsx');
    };

    document.getElementById('progress-upload-btn').onclick = function() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.xlsx';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, {type: 'array'});
          const sheet = workbook.Sheets[workbook.SheetNames[0]];
          const json = XLSX.utils.sheet_to_json(sheet, {header:1});
          // í—¤ë” ì¸ë±ìŠ¤ ì°¾ê¸°
          let headerIdx = -1;
          for(let i=0;i<json.length;i++) {
            if(json[i].includes('í˜„ì¥ëª…') && json[i].includes('êµ¬ë¶„')) {
              headerIdx = i;
              break;
            }
          }
          if(headerIdx === -1) { alert('ì—‘ì…€ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
          // í—¤ë” ë§¤í•‘
          const header = json[headerIdx];
          const siteIdx = header.indexOf('í˜„ì¥ëª…');
          const typeIdx = header.indexOf('êµ¬ë¶„');
          const kindIdx = header.indexOf('ê³„ì‚°ì„œìœ ë¬´');
          const amountIdx = header.indexOf('ê¸ˆì•¡');
          const dateIdx = header.indexOf('ë‚ ì§œ');
          const noteIdx = header.indexOf('ë¹„ê³ ');
          // ë°ì´í„° ì¶”ì¶œ
          const allData = JSON.parse(localStorage.getItem('progressData')||'[]');
          for(let i=headerIdx+1;i<json.length;i++) {
            const row = json[i];
            const site = row[siteIdx] ? row[siteIdx]+'' : '';
            const type = row[typeIdx] ? row[typeIdx]+'' : '';
            const kind = row[kindIdx] ? row[kindIdx]+'' : '';
            const amount = row[amountIdx] ? row[amountIdx]+'' : '';
            const date = row[dateIdx] ? row[dateIdx]+'' : '';
            const note = row[noteIdx] ? row[noteIdx]+'' : '';
            if(!site || !type || !kind || !amount || !date) continue; // í•„ìˆ˜ê°’
            allData.push({site, type, kind, amount, date, note});
          }
          localStorage.setItem('progressData', JSON.stringify(allData));
          renderProgressMonthTable();
          renderProgressTodayInfo();
          renderProgressSiteTable();
          alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        };
        reader.readAsArrayBuffer(file);
      };
      input.click();
    };

    // ê³µì‚¬í˜„í™© ë©”ë‰´ í´ë¦­ ì‹œ ìƒˆë¡œê³ ì¹¨ ìˆ˜ì •
    const menuItems = document.querySelectorAll('.menu-item');
    if(menuItems[0]) {
      menuItems[0].onclick = function() {
        // ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬ í›„ ìƒˆë¡œê³ ì¹¨
        if(localStorage.getItem('isLogin') === 'Y') {
          location.reload();
        } else {
          alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
          document.getElementById('login-section').style.display = 'flex';
        }
      };
    }

    // íšŒì›í˜„í™© ë©”ë‰´ í´ë¦­ ì‹œ í™”ë©´ ì „í™˜
    const menuMember = document.getElementById('menu-member');
    if(menuMember) {
      menuMember.onclick = function() {
        document.querySelectorAll('section').forEach(s => s.style.display = 'none');
        document.getElementById('member-section').style.display = 'block';
        renderMemberSection();
      };
    }

    // --- íšŒì› ë°ì´í„° ë° íšŒì›í˜„í™© í™”ë©´ ì™„ì „ ë³µì› ---
    let memberData = {
      admin: [
        {id: 'fire8803', name: 'ê´€ë¦¬ì', org: 'ì´ê´„', pw: 'power520!!', role: 'ê´€ë¦¬ì'},
      ],
      user: [
        {id: 'user1', name: 'í™ê¸¸ë™', org: 'AíšŒì‚¬', pw: 'userpw1', role: 'ì¼ë°˜íšŒì›'},
      ],
      request: [
        {id: 'req1', name: 'ì‹ ì²­ì', org: 'BíšŒì‚¬', pw: 'reqpw1', role: 'ìš”ì²­'},
      ]
    };
    if(localStorage.getItem('memberData')) {
      memberData = JSON.parse(localStorage.getItem('memberData'));
    } else {
      localStorage.setItem('memberData', JSON.stringify(memberData));
    }
    function renderMemberSection() {
      // ìƒˆë¡œìš´ í…Œì´ë¸” êµ¬ì¡°: í•œ ì¤„ì— ëª¨ë“  ê¶Œí•œ ì»¬ëŸ¼(ë§ˆìŠ¤í„°/ê´€ë¦¬ì/ì¼ë°˜íšŒì›/ìš”ì²­/íšŒì›ê±°ì ˆ)
      function makeTable(title, list) {
        return `
        <div>
          <h3>${title}</h3>
          <div class="member-table-wrap">
            <table class="member-table">
              <thead>
                <tr>
                  <th>ì•„ì´ë””</th>
                  <th>ì´ë¦„</th>
                  <th>ì†Œì†</th>
                  <th>ë¹„ë°€ë²ˆí˜¸</th>
                  <th>ë§ˆìŠ¤í„°</th>
                  <th>ê´€ë¦¬ì</th>
                  <th>ì¼ë°˜íšŒì›</th>
                  <th>ìš”ì²­</th>
                  <th>íšŒì›ê±°ì ˆ</th>
                  <th>ê¶Œí•œë³€ê²½</th>
                </tr>
              </thead>
              <tbody>
                ${list.map((m, idx) => `
                  <tr>
                    <td>${m.id}</td>
                    <td>${m.name}</td>
                    <td>${m.org}</td>
                    <td><span class="pw-blind" style="letter-spacing:2px;">${'*'.repeat(m.pw.length)}</span> <button class="pw-eye-btn" data-type="${title}" data-idx="${idx}"></button></td>
                    <td>${m.role==='ë§ˆìŠ¤í„°'?'<span style="color:#e53935;font-weight:bold;">â—</span>':''}</td>
                    <td>${m.role==='ê´€ë¦¬ì'?'<span style="color:#1976d2;font-weight:bold;">â—</span>':''}</td>
                    <td>${m.role==='ì¼ë°˜íšŒì›'?'<span style="color:#1976d2;font-weight:bold;">â—</span>':''}</td>
                    <td>${m.role==='ìš”ì²­'?'<span style="color:#1976d2;font-weight:bold;">â—</span>':''}</td>
                    <td>${m.role==='íšŒì›ê±°ì ˆ'?'<span style="color:#e53935;font-weight:bold;">â—</span>':''}</td>
                    <td>
                      ${m.role==='ë§ˆìŠ¤í„°' ? '<span style="color:#e53935;font-weight:bold;">ë§ˆìŠ¤í„°</span>' : `
                        <select class="role-select" data-type="${title}" data-idx="${idx}">
                          <option value="ê´€ë¦¬ì"${m.role==='ê´€ë¦¬ì'?' selected':''}>ê´€ë¦¬ì</option>
                          <option value="ì¼ë°˜íšŒì›"${m.role==='ì¼ë°˜íšŒì›'?' selected':''}>ì¼ë°˜íšŒì›</option>
                          <option value="ìš”ì²­"${m.role==='ìš”ì²­'?' selected':''}>ìš”ì²­</option>
                          <option value="íšŒì›ê±°ì ˆ"${m.role==='íšŒì›ê±°ì ˆ'?' selected':''}>íšŒì›ê±°ì ˆ</option>
                        </select>`}
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>`;
      }
      const section = document.getElementById('member-section');
      section.innerHTML = `
        <div style="max-width:900px; margin:0 auto;">
          <h2 style="color:#1976d2;">íšŒì›í˜„í™©</h2>
          <div class="member-vertical-list">
            ${makeTable('ì‹ ì²­ëª©ë¡', memberData.request)}
            ${makeTable('ì¼ë°˜íšŒì›', memberData.user)}
            ${makeTable('ê´€ë¦¬ì', memberData.admin)}
          </div>
        </div>
      `;
      // ë¹„ë°€ë²ˆí˜¸ ë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll('.pw-eye-btn').forEach(btn => {
        btn.onclick = function() {
          const type = btn.dataset.type;
          const idx = parseInt(btn.dataset.idx);
          let m;
          if(type==='ì‹ ì²­ëª©ë¡') m = memberData.request[idx];
          else if(type==='ì¼ë°˜íšŒì›') m = memberData.user[idx];
          else m = memberData.admin[idx];
          const pwSpan = this.closest('td').querySelector('.pw-blind');
          if(this.classList.contains('active')) {
            pwSpan.textContent = '*'.repeat(m.pw.length);
            this.classList.remove('active');
          } else {
            pwSpan.textContent = m.pw;
            this.classList.add('active');
          }
        };
      });
      // ê¶Œí•œ ë³€ê²½ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸
      document.querySelectorAll('.role-select').forEach(select => {
        select.onchange = function() {
          const type = select.dataset.type;
          const idx = parseInt(select.dataset.idx);
          let m;
          let fromList;
          if(type==='ì‹ ì²­ëª©ë¡') { m = memberData.request[idx]; fromList = memberData.request; }
          else if(type==='ì¼ë°˜íšŒì›') { m = memberData.user[idx]; fromList = memberData.user; }
          else { m = memberData.admin[idx]; fromList = memberData.admin; }
          const newRole = this.value;
          // íšŒì›ê±°ì ˆ ì„ íƒ ì‹œ íŒì—…
          if (newRole === 'íšŒì›ê±°ì ˆ') {
            document.getElementById('member-delete-popup').style.display = 'flex';
            document.getElementById('member-delete-confirm').onclick = function() {
              fromList.splice(idx, 1);
              localStorage.setItem('memberData', JSON.stringify(memberData));
              document.getElementById('member-delete-popup').style.display = 'none';
              renderMemberSection();
            };
            document.getElementById('member-delete-cancel').onclick = function() {
              document.getElementById('member-delete-popup').style.display = 'none';
              select.value = m.role;
            };
            return;
          }
          fromList.splice(idx, 1);
          if(newRole==='ê´€ë¦¬ì') memberData.admin.push(m);
          else if(newRole==='ì¼ë°˜íšŒì›') memberData.user.push(m);
          else if(newRole==='ìš”ì²­') memberData.request.push(m);
          m.role = newRole;
          localStorage.setItem('memberData', JSON.stringify(memberData));
          renderMemberSection();
        };
      });
    }

    // --- ë©”ë‰´ê¶Œí•œ ê´€ë¦¬ ì™„ì „ ë³µì› ë° ì¦‰ì‹œ ë°˜ì˜ ---
    let menuAuth = {
      'ê³µì‚¬í˜„í™©': { ê´€ë¦¬ì: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:1, ë‚´ë ¤ë°›ê¸°:1, ìˆ˜ì •:1}, ì¼ë°˜íšŒì›: {ì½ê¸°:1, ì“°ê¸°:0, ì˜¬ë¦¬ê¸°:0, ë‚´ë ¤ë°›ê¸°:0, ìˆ˜ì •:0} },
      'í˜„ì¥ì„¸ë¶€ë‚´ì—­': { ê´€ë¦¬ì: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:1, ë‚´ë ¤ë°›ê¸°:1, ìˆ˜ì •:1}, ì¼ë°˜íšŒì›: {ì½ê¸°:1, ì“°ê¸°:0, ì˜¬ë¦¬ê¸°:0, ë‚´ë ¤ë°›ê¸°:0, ìˆ˜ì •:0} },
      'ê±°ë˜ì²˜ í˜„í™©': { ê´€ë¦¬ì: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:1, ë‚´ë ¤ë°›ê¸°:1, ìˆ˜ì •:1}, ì¼ë°˜íšŒì›: {ì½ê¸°:1, ì“°ê¸°:0, ì˜¬ë¦¬ê¸°:0, ë‚´ë ¤ë°›ê¸°:0, ìˆ˜ì •:0} },
      'í˜‘ì˜í•˜ê¸°': { ê´€ë¦¬ì: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:1, ë‚´ë ¤ë°›ê¸°:1, ìˆ˜ì •:1}, ì¼ë°˜íšŒì›: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:0, ë‚´ë ¤ë°›ê¸°:0, ìˆ˜ì •:0} },
      'ê¸°ì„±í˜„í™©': { ê´€ë¦¬ì: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:1, ë‚´ë ¤ë°›ê¸°:1, ìˆ˜ì •:1}, ì¼ë°˜íšŒì›: {ì½ê¸°:0, ì“°ê¸°:0, ì˜¬ë¦¬ê¸°:0, ë‚´ë ¤ë°›ê¸°:0, ìˆ˜ì •:0} }
    };
    if(localStorage.getItem('menuAuth')) {
      menuAuth = JSON.parse(localStorage.getItem('menuAuth'));
    } else {
      localStorage.setItem('menuAuth', JSON.stringify(menuAuth));
    }
    function renderAuthSection() {
      const tbody = document.getElementById('auth-tbody');
      if (!tbody) return;
      const menus = Object.keys(menuAuth);
      tbody.innerHTML = '';
      menus.forEach(menu => {
        ['ê´€ë¦¬ì','ì¼ë°˜íšŒì›'].forEach(role => {
          const tr = document.createElement('tr');
          if(role === 'ê´€ë¦¬ì') tr.innerHTML += `<td rowspan="2" style="font-weight:bold;">${menu}</td>`;
          tr.innerHTML += `<td>${role}</td>`;
          ['ì½ê¸°','ì“°ê¸°','ì˜¬ë¦¬ê¸°','ë‚´ë ¤ë°›ê¸°','ìˆ˜ì •'].forEach(auth => {
            tr.innerHTML += `<td><input type="checkbox" class="auth-chk" data-menu="${menu}" data-role="${role}" data-auth="${auth}" ${menuAuth[menu][role][auth] ? 'checked' : ''}></td>`;
          });
          tbody.appendChild(tr);
        });
      });
      // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
      tbody.querySelectorAll('.auth-chk').forEach(chk => {
        chk.onchange = function() {
          const menu = chk.dataset.menu;
          const role = chk.dataset.role;
          const auth = chk.dataset.auth;
          menuAuth[menu][role][auth] = chk.checked ? 1 : 0;
          localStorage.setItem('menuAuth', JSON.stringify(menuAuth));
          renderAuthSection();
          applyMenuAuth();
        };
      });
    }
    // --- ê¶Œí•œë³„ ë©”ë‰´ ë…¸ì¶œ/ìˆ¨ê¹€ ì™„ì „ ì ìš© ---
    function applyMenuAuth() {
      const isMaster = localStorage.getItem('isMaster') === 'Y';
      const isAdmin = localStorage.getItem('isAdmin') === 'Y';
      const menuAuth = JSON.parse(localStorage.getItem('menuAuth'));
      
      document.querySelectorAll('.menu-item').forEach(el => {
        const menuName = el.textContent.trim();
        if(isMaster) {
          el.style.display = '';
        } else if(isAdmin && menuAuth[menuName]?.ê´€ë¦¬ì?.ì½ê¸°) {
          el.style.display = '';
        } else if(!isMaster && !isAdmin && menuAuth[menuName]?.ì¼ë°˜íšŒì›?.ì½ê¸°) {
          el.style.display = '';
        } else {
          el.style.display = 'none';
        }
      });
    }
   
    // --- í˜ì´ì§€ ì§„ì… ì‹œ ë©”ë‰´ê¶Œí•œ ì ìš© ---
    window.addEventListener('DOMContentLoaded', function() {
      applyMenuAuth();
    });

    document.getElementById('signup-close').onclick = function() {
      document.getElementById('signup-popup').style.display = 'none';
    };

    document.getElementById('signup-form').onsubmit = function(e) {
      e.preventDefault();
      const id = document.getElementById('signup-id').value.trim();
      const pw = document.getElementById('signup-pw').value.trim();
      const pwConfirm = document.getElementById('signup-pw-confirm').value.trim();
      const name = document.getElementById('signup-name').value.trim();
      const org = document.getElementById('signup-org').value.trim();

      // ì…ë ¥ê°’ ê²€ì¦
      if(!id || !pw || !pwConfirm || !name || !org) {
        document.getElementById('signup-error').textContent = 'ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        document.getElementById('signup-error').style.display = 'block';
        return;
      }

      if(pw !== pwConfirm) {
        document.getElementById('signup-error').textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        document.getElementById('signup-error').style.display = 'block';
        return;
      }

      // ì•„ì´ë”” ì¤‘ë³µ ì²´í¬
      const memberData = JSON.parse(localStorage.getItem('memberData') || '{"admin":[],"user":[],"request":[]}');
      const allMembers = [...memberData.admin, ...memberData.user, ...memberData.request];
      if(allMembers.some(m => m.id === id)) {
        document.getElementById('signup-error').textContent = 'ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.';
        document.getElementById('signup-error').style.display = 'block';
        return;
      }

      // íšŒì›ê°€ì… ì²˜ë¦¬
      const newMember = {
        id,
        pw,
        name,
        org,
        role: 'ìš”ì²­',
        requestDate: new Date().toISOString() // ì‹ ì²­ì¼ì‹œ ì¶”ê°€
      };

      memberData.request.push(newMember);
      localStorage.setItem('memberData', JSON.stringify(memberData));

      // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ í›„ íŒì—… ë‹«ê¸°
      alert(`íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì´ë¦„: ${name}\nì•„ì´ë””: ${id}\nì†Œì†: ${org}\n\nê´€ë¦¬ìì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.`);
      document.getElementById('signup-popup').style.display = 'none';
      document.getElementById('signup-form').reset();
      document.getElementById('signup-error').style.display = 'none';
    };

    // íŒì—… HTML ì¶”ê°€
    if (!document.getElementById('member-delete-popup')) {
      const popup = document.createElement('div');
      popup.id = 'member-delete-popup';
      popup.style = 'display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:99999;background:rgba(0,0,0,0.15);align-items:center;justify-content:center;';
      popup.innerHTML = `
        <div style="background:#fff;padding:2rem 2.5rem;border-radius:16px;box-shadow:0 4px 24px #1976d233;display:flex;flex-direction:column;gap:1.2rem;min-width:320px;align-items:center;">
          <div style="font-size:1.2rem;font-weight:bold;color:#e53935;text-align:center;margin-bottom:1rem;">ì •ë§ë¡œ ì´ íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
          <div style="display:flex;gap:1.5rem;justify-content:center;">
            <button id="member-delete-confirm" style="background:#e53935;color:#fff;border:none;border-radius:8px;padding:0.7rem 2.2rem;font-size:1.1rem;font-weight:500;cursor:pointer;">ì‚­ì œ</button>
            <button id="member-delete-cancel" style="background:#b6c7e3;color:#333;border:none;border-radius:8px;padding:0.7rem 2.2rem;font-size:1.1rem;font-weight:500;cursor:pointer;">ì·¨ì†Œ</button>
          </div>
        </div>
      `;
      document.body.appendChild(popup);
    }

    // ë¡œê·¸ì¸ í™”ë©´ì—ì„œ íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­ ì‹œ íŒì—… ì—´ê¸°
    document.getElementById('show-signup-btn').onclick = function() {
      document.getElementById('signup-popup').style.display = 'block';
    };

    // ì´ˆê¸° ë°ì´í„° ì •ì˜
    const defaultMemberData = {
      admin: [],
      user: [],
      request: []
    };

    // localStorage ì´ˆê¸°í™”
    localStorage.setItem('memberData', JSON.stringify(defaultMemberData));
    localStorage.removeItem('loginId');
    localStorage.removeItem('isAdmin');

    const defaultMenuAuth = {
      'ê³µì‚¬í˜„í™©': { ê´€ë¦¬ì: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:1, ë‚´ë ¤ë°›ê¸°:1, ìˆ˜ì •:1}, ì¼ë°˜íšŒì›: {ì½ê¸°:1, ì“°ê¸°:0, ì˜¬ë¦¬ê¸°:0, ë‚´ë ¤ë°›ê¸°:0, ìˆ˜ì •:0} },
      'í˜„ì¥ì„¸ë¶€ë‚´ì—­': { ê´€ë¦¬ì: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:1, ë‚´ë ¤ë°›ê¸°:1, ìˆ˜ì •:1}, ì¼ë°˜íšŒì›: {ì½ê¸°:1, ì“°ê¸°:0, ì˜¬ë¦¬ê¸°:0, ë‚´ë ¤ë°›ê¸°:0, ìˆ˜ì •:0} },
      'ê±°ë˜ì²˜ í˜„í™©': { ê´€ë¦¬ì: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:1, ë‚´ë ¤ë°›ê¸°:1, ìˆ˜ì •:1}, ì¼ë°˜íšŒì›: {ì½ê¸°:1, ì“°ê¸°:0, ì˜¬ë¦¬ê¸°:0, ë‚´ë ¤ë°›ê¸°:0, ìˆ˜ì •:0} },
      'í˜‘ì˜í•˜ê¸°': { ê´€ë¦¬ì: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:1, ë‚´ë ¤ë°›ê¸°:1, ìˆ˜ì •:1}, ì¼ë°˜íšŒì›: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:0, ë‚´ë ¤ë°›ê¸°:0, ìˆ˜ì •:0} },
      'ê¸°ì„±í˜„í™©': { ê´€ë¦¬ì: {ì½ê¸°:1, ì“°ê¸°:1, ì˜¬ë¦¬ê¸°:1, ë‚´ë ¤ë°›ê¸°:1, ìˆ˜ì •:1}, ì¼ë°˜íšŒì›: {ì½ê¸°:0, ì“°ê¸°:0, ì˜¬ë¦¬ê¸°:0, ë‚´ë ¤ë°›ê¸°:0, ìˆ˜ì •:0} }
    };

    // localStorage ì´ˆê¸°í™”
    localStorage.clear();

    // ì´ˆê¸° ë°ì´í„° ì €ì¥
    localStorage.setItem('memberData', JSON.stringify(defaultMemberData));
    localStorage.setItem('menuAuth', JSON.stringify(defaultMenuAuth));

    // ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
    localStorage.setItem('loginId', '');
    localStorage.setItem('isAdmin', 'Y');
    localStorage.setItem('isMaster', 'N');

    // ë©”ë‰´ ê¶Œí•œ í™•ì¸
    console.log(JSON.parse(localStorage.getItem('menuAuth')));
    console.log('ê¸°ì„±í˜„í™© ë©”ë‰´ ê¶Œí•œ:', checkMenuAuth('ê¸°ì„±í˜„í™©'));

    // ë¡œê·¸ì¸ ì²˜ë¦¬
    function handleLogin() {
      const id = document.getElementById('loginId').value;
      const pw = document.getElementById('loginPw').value;
      
      if(!id || !pw) {
        alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      // localStorage ì´ˆê¸°í™” í™•ì¸
      if (!localStorage.getItem('memberData')) {
        localStorage.setItem('memberData', JSON.stringify({
          admin: [],
          user: [],
          request: []
        }));
      }

      const memberData = JSON.parse(localStorage.getItem('memberData'));
      
      // ê´€ë¦¬ì í™•ì¸
      const admin = memberData.admin.find(m => m.id === id && m.pw === pw);
      if(admin) {
        localStorage.setItem('loginId', id);
        localStorage.setItem('isAdmin', 'Y');
        location.href = 'last_one.html';
        return;
      }

      // ì¼ë°˜ íšŒì› í™•ì¸
      const user = memberData.user.find(m => m.id === id && m.pw === pw);
      if(user) {
        localStorage.setItem('loginId', id);
        localStorage.setItem('isAdmin', 'N');
        location.href = 'last_one.html';
        return;
      }

      alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ localStorage ì´ˆê¸°í™”
    window.onload = function() {
      localStorage.clear();
      localStorage.setItem('memberData', JSON.stringify({
        admin: [],
        user: [],
        request: []
      }));
      localStorage.setItem('menuAuth', JSON.stringify(defaultMenuAuth));
    };

    // ë©”ë‰´ ê¶Œí•œ ì²´í¬ í•¨ìˆ˜
    function checkMenuAuth(url) {
      const loginId = localStorage.getItem('loginId');
      const isAdmin = localStorage.getItem('isAdmin');
      const menuAuth = JSON.parse(localStorage.getItem('menuAuth'));

      // ê´€ë¦¬ìëŠ” ëª¨ë“  ê¶Œí•œ í—ˆìš©
      if(isAdmin === 'Y') return true;

      // URLì—ì„œ ë©”ë‰´ ID ì¶”ì¶œ
      const menuId = url.split('.')[0];
      
      // í•´ë‹¹ ë©”ë‰´ì˜ ê¶Œí•œ í™•ì¸
      if(menuAuth[loginId] && menuAuth[loginId][menuId]) {
        return menuAuth[loginId][menuId].read === 1;
      }

      return false;
    }

    // ë©”ë‰´ í´ë¦­ ì´ë²¤íŠ¸
    function goToPage(url) {
      if(!checkMenuAuth(url)) {
        alert('ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      location.href = url;
    }

    // ê¸°ì„±í˜„í™© íƒ­ í´ë¦­ ì´ë²¤íŠ¸
    document.addEventListener('DOMContentLoaded', function() {
      const progressTab = document.getElementById('progress-tab');
      if (progressTab) {
        progressTab.addEventListener('click', function() {
          if(localStorage.getItem('isMaster') !== 'Y' && localStorage.getItem('isAdmin') !== 'Y') {
            alert('ê´€ë¦¬ì ë˜ëŠ” ë§ˆìŠ¤í„°ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            return;
          }
          document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
          const progressContent = document.getElementById('progress-content');
          if (progressContent) progressContent.style.display = 'block';
          document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
          this.classList.add('active');
        });
      }

      // ê¸°ì„±í˜„í™© ì €ì¥ ë²„íŠ¼
      const saveProgressBtn = document.getElementById('save-progress');
      if (saveProgressBtn) {
        saveProgressBtn.addEventListener('click', function() {
          if(localStorage.getItem('isMaster') !== 'Y' && localStorage.getItem('isAdmin') !== 'Y') {
            alert('ê´€ë¦¬ì ë˜ëŠ” ë§ˆìŠ¤í„°ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            return;
          }
          const siteId = document.getElementById('progress-site').value;
          const month = document.getElementById('progress-month').value;
          const progress = document.getElementById('progress-value').value;
          
          if(!siteId || !month || !progress) {
            alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
          }

          const progressData = JSON.parse(localStorage.getItem('progressData') || '{}');
          if(!progressData[siteId]) progressData[siteId] = {};
          progressData[siteId][month] = progress;
          localStorage.setItem('progressData', JSON.stringify(progressData));
          alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
          renderProgressList();
        });
      }

      // ê¸°ì„±í˜„í™© ì‚­ì œ ë²„íŠ¼
      const deleteProgressBtn = document.getElementById('delete-progress');
      if (deleteProgressBtn) {
        deleteProgressBtn.addEventListener('click', function() {
          if(localStorage.getItem('isMaster') !== 'Y' && localStorage.getItem('isAdmin') !== 'Y') {
            alert('ê´€ë¦¬ì ë˜ëŠ” ë§ˆìŠ¤í„°ë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            return;
          }
          const siteId = document.getElementById('progress-site').value;
          const month = document.getElementById('progress-month').value;
          
          if(!siteId || !month) {
            alert('ì‚­ì œí•  í˜„ì¥ê³¼ ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
          }

          if(!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

          const progressData = JSON.parse(localStorage.getItem('progressData') || '{}');
          if(progressData[siteId] && progressData[siteId][month]) {
            delete progressData[siteId][month];
            localStorage.setItem('progressData', JSON.stringify(progressData));
            alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            renderProgressList();
          }
        });
      }
    });

  </script>
</body>
</html> 